{"version":3,"file":"index.js","sources":["collection-view/empty-fetch/index.js","collection-view/empty-view/index.js","collection-view/improved-indexes/index.js","collection-view/next-collection-view/index.js","collection-view/customs/index.js","collection-view/fetch-next/index.js","common/improved-fetch/index.js","common/childrenable/index.js","common/nested-entities/index.js","common/options/index.js","common/url-pattern/index.js","common/render-on-model-change/index.js","common/index.js","model/smart-get/get-nested-result.js","model/smart-get/get-property-schema.js","model/smart-get/get-display-config.js","model/smart-get/index.js","model/save-as-promise/index.js","view/build-view-by-key/index.js","view/css-class-modifiers/index.js","view/destroy-view/index.js","view/nested-views/build-region.js","view/nested-views/normalize-region.js","view/nested-views/index.js","view/scroll-handler/index.js","view/sortable-behavior/index.js","view/dragdrop/helpers.js","view/dragdrop/interaction-behavior.js","view/dragdrop/swappable-behavior.js","collection/create-as-promise/index.js"],"sourcesContent":["export default CollectionView => CollectionView.extend({\r\n\tshouldHandleEmptyFetch: true, \r\n\tconstructor(){\r\n\t\tCollectionView.apply(this, arguments);\r\n\r\n\t\tthis.getOption('shouldHandleEmptyFetch') && this.emptyView\r\n\t\t\t&& this._handleEmptyFetch();\r\n\t},\r\n\t_handleEmptyFetch(){\r\n\t\tif (!this.collection || this.collection.length) { return; }\r\n\r\n\t\tthis.listenToOnce(this.collection, 'sync', \r\n\t\t\t() => !this.collection.length && this._renderChildren()\r\n\t\t);\r\n\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\n\r\nexport default Base => Base.extend({\r\n\temptyView(){\r\n\t\treturn this._emptyViewSelector({\r\n\t\t\tfetching: this.isFetching(),\r\n\t\t\tfetched: this.isFetched(),\r\n\t\t});\r\n\t},\r\n\tisFetching(){\r\n\t\treturn this.collection && _.isFunction(this.collection.isFetching) && this.collection.isFetching();\r\n\t},\r\n\tisFetched(){\r\n\t\treturn this.collection && _.isFunction(this.collection.isFetched) && this.collection.isFetched();\r\n\t},\r\n\t_emptyViewSelector({ fetching, fetched }={}){\r\n\t\tlet wait = this.getOption('waitView');\r\n\t\tlet nodata = this.getOption('noDataView');\r\n\t\tif (fetching && !fetched){\r\n\t\t\treturn wait || nodata;\r\n\t\t} else {\r\n\t\t\treturn nodata;\r\n\t\t}\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nfunction rebuildIndexes() {\r\n\tif (!this.getOption('shouldRebuildIndexes') || !this.collection) {\r\n\t\treturn;\r\n\t}\r\n\tlet models = this.collection.models;\r\n\tfor (let index = 0, length = models.length; index < length; index++) {\r\n\t\tlet model = models[index];\r\n\t\tlet view = this._children.findByModel(model);\r\n\t\tview && (view._index = index);\r\n\t}\r\n}\r\n\r\nexport default CollectionView => CollectionView.extend({\r\n\tshouldRebuildIndexes: true,\r\n\r\n\tconstructor() {\t\t\r\n\t\t\r\n\t\tCollectionView.apply(this, arguments);\r\n\t\tthis.on('before:sort', rebuildIndexes.bind(this));\r\n\t},\r\n\t_addChild(view, index){\r\n\t\tview._isModelView = arguments.length === 1;\r\n\t\tif(_.isObject(index)) {\r\n\t\t\tindex = index.index;\r\n\t\t}\r\n\t\tif (index != null) {\r\n\t\t\tview._index = index;\r\n\t\t}\r\n\t\treturn CollectionView.prototype._addChild.apply(this, arguments);\r\n\t},\r\n\t_viewComparator(v1,v2){\r\n\t\tlet res = v1._index - v2._index;\r\n\t\tif (res) return res;\r\n\t\tif (v1._isModelView) return 1;\r\n\t\treturn -1;\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nexport default CollectionView => CollectionView.extend({\r\n\t_renderChildren() {\r\n\t\t// If there are unrendered views prevent add to end perf\r\n\t\tif (this._hasUnrenderedViews) {\r\n\t\t\tdelete this._addedViews;\r\n\t\t\tdelete this._hasUnrenderedViews;\r\n\t\t}\r\n\r\n\t\tconst views = this._addedViews || this.children._views;\r\n\r\n\t\tthis.triggerMethod('before:render:children', this, views);\r\n\t\r\n\t\tthis._showEmptyView();\r\n\t\r\n\t\tconst els = this._getBuffer(views);\r\n\t\r\n\t\tthis._attachChildren(els, views);\r\n\t\r\n\t\tdelete this._addedViews;\r\n\t\r\n\t\tthis.triggerMethod('render:children', this, views);\r\n\t},\r\n\taddChildView(view, index, options = {}) {\r\n\t\tif (!view || view._isDestroyed) {\r\n\t\t\treturn view;\r\n\t\t}\r\n\r\n\t\tif (_.isObject(index)) {\r\n\t\t\toptions = index;\r\n\t\t}\r\n\r\n\t\t// If options has defined index we should use it\r\n\t\tif (options.index != null) {\r\n\t\t\tindex = options.index;\r\n\t\t}\r\n\r\n\t\tif (!this._isRendered && !options.preventRender) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\r\n\t\tthis._addChild(view, index);\r\n\r\n\t\tif (options.preventRender) {\r\n\t\t\tthis._hasUnrenderedViews = true;\r\n\t\t\treturn view;\r\n\t\t}\r\n\r\n\t\tconst hasIndex = (typeof index !== 'undefined');\r\n\t\tconst isAddedToEnd = !hasIndex || index >= this._children.length;\r\n\r\n\t\t// Only cache views if added to the end and there is no unrendered views\r\n\t\tif (isAddedToEnd && !this._hasUnrenderedViews) {\r\n\t\t\tthis._addedViews = [view];\r\n\t\t}\r\n\t\t\r\n\t\tif (hasIndex) {\r\n\t\t\tthis._renderChildren();\r\n\t\t} else {\r\n\t\t\tthis.sort();\r\n\t\t}\r\n\t\r\n\t\treturn view;\r\n\t},\r\n\t_showEmptyView() {\r\n\r\n\t\tthis._destroyEmptyView();\r\n\t\r\n\t\tif(!this.isEmpty()) { return; }\r\n\r\n\t\tconst EmptyView = this._getEmptyView();\t\r\n\t\tif (!EmptyView) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tconst options = this._getEmptyViewOptions();\r\n\t\tthis._emptyViewInstance = new EmptyView(options);\r\n\t\r\n\t\tthis.addChildView(this._emptyViewInstance, { preventRender: true, index: 0, });\r\n\t\r\n\t},\r\n\t_destroyEmptyView(){\r\n\t\tlet view = this._emptyViewInstance;\r\n\t\tif (!view) return;\r\n\t\r\n\t\tthis._removeChildView(view);\r\n\t\r\n\t\tthis._removeChild(view);\r\n\t\r\n\t\tview.destroy();\r\n\t\tdelete this._emptyViewInstance;\r\n\t},\r\n}, { CollectionViewMixin_4x: true});\r\n","import _ from 'underscore';\r\nimport { isView, isViewClass } from 'bbmn-core';\r\nimport { betterResult } from 'bbmn-utils';\r\n\r\nexport default Base => Base.extend({\r\n\t\r\n\trenderAllCustoms: false,\r\n\tshouldMergeCustoms: false,\r\n\trenderCollection: true,\r\n\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tif (this.getOption('renderCollection') === false && this.collection) {\r\n\t\t\tthis._collection = this.collection;\r\n\t\t\tdelete this.collection;\r\n\t\t}\r\n\t\tthis._initializeCustoms();\r\n\t},\r\n\t_getCustomsArray(){\r\n\t\tif (!this._customs)\r\n\t\t\tthis._customs = [];\r\n\t\treturn this._customs;\r\n\t},\r\n\tgetCollection(){\r\n\t\treturn this.collection || this._collection;\r\n\t},\r\n\tclearCustoms(){\r\n\t\tlet arr = this._getCustomsArray();\r\n\t\tarr.length = 0;\r\n\t},\r\n\taddCustom(...args){\r\n\t\tlet arr = this._getCustomsArray();\r\n\t\tarr.push(...args);\r\n\t},\r\n\tunshiftCustom(...args){\r\n\t\tlet arr = this._getCustomsArray();\r\n\t\tarr.unshift(...args);\r\n\t},\r\n\t_initializeCustoms(){\r\n\r\n\t\tlet optionsCustoms = betterResult(this.options, 'customs', { args: [this], context: this });\r\n\t\tlet instanceCustoms = betterResult(this, 'customs', { args: [this] });\r\n\t\tlet shouldMergeCustoms = this.getOption('shouldMergeCustoms');\r\n\t\tlet add;\r\n\t\tif (shouldMergeCustoms) {\r\n\t\t\tadd = (instanceCustoms || []).concat(optionsCustoms || []);\t\t\t\r\n\t\t} else {\r\n\t\t\tadd = instanceCustoms || optionsCustoms || [];\r\n\t\t}\r\n\r\n\t\tthis.addCustom(...add);\r\n\r\n\t\tif (this.getOption('renderAllCustoms')) {\r\n\t\t\tthis.on('render', this._renderCustoms);\r\n\t\t}\r\n\t},\r\n\trenderCustoms(){\r\n\t\tthis.triggerMethod('before:customs:render');\r\n\r\n\t\t_.each(this._renderedCustoms, view => view.destroy());\r\n\t\tlet registered = this._getCustoms();\r\n\t\tlet rawcustoms = this.getCustoms(registered);\r\n\t\tlet customs = this._prepareCustoms(rawcustoms);\r\n\r\n\t\tthis._renderedCustoms = this.addChildViews(customs);\r\n\r\n\t\tthis.triggerMethod('customs:render');\r\n\t},\r\n\t_renderCustoms(){\r\n\t\tif (!this.getOption('renderAllCustoms')) return;\r\n\t\tthis.renderCustoms();\r\n\t},\r\n\t_getCustoms() {\r\n\t\tlet arr = this._getCustomsArray();\r\n\t\treturn _.clone(arr);\r\n\t},\r\n\tgetCustoms(customs) {\t\t\r\n\t\treturn customs;\r\n\t},\r\n\t_prepareCustoms(rawcustoms){\r\n\t\treturn _.reduce(rawcustoms, (array, item) => {\r\n\t\t\tlet args = this._prepareCustom(item);\r\n\t\t\targs && (args = this.buildCustom(...args));\r\n\t\t\targs && array.push(args);\r\n\t\t\treturn array;\r\n\t\t},[]);\r\n\t},\r\n\t_prepareCustom(arg){\r\n\t\tif (_.isArray(arg)) {\r\n\t\t\treturn arg;\r\n\t\t}\r\n\t\tif (isView(arg) || isViewClass(arg)) {\r\n\t\t\treturn [arg, { index: 0 }];\r\n\t\t}\r\n\t\tif (_.isFunction(arg)) {\r\n\t\t\treturn this._prepareCustom(arg.call(this, this));\r\n\t\t}\r\n\t\treturn [arg, { index: 0 }];\r\n\t\t// if (_.isArray(arg)) {\r\n\t\t// \treturn arg;\r\n\t\t// } else {\r\n\t\t// \treturn [arg, { index: 0 }];\r\n\t\t// }\r\n\t},\r\n\tbuildCustom(view, options = {}){ \r\n\t\tlet childOptions = this.getOption('customViewOptions', { args: [ this ]});\r\n\t\tif (isViewClass(view)) {\r\n\t\t\tview = new view(childOptions);\r\n\t\t} else if (_.isFunction(view)) {\r\n\t\t\tview = view.call(this, this, childOptions);\r\n\t\t} else if(!isView(view) && _.isObject(view) && 'view' in view) {\r\n\t\t\tif(isView(view.view)) {\r\n\t\t\t\tif(_.isObject(view.options))\r\n\t\t\t\t\toptions = view.options;\r\n\t\t\t\tview = view.view;\r\n\t\t\t} else if(isViewClass(view.view)) {\r\n\t\t\t\tlet options = betterResult(view, 'options', { context: this, args: [this, childOptions]});\r\n\t\t\t\tlet viewOptions = _.extend({}, childOptions, options);\r\n\t\t\t\tview = new view.view(viewOptions);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (isView(view)) {\r\n\t\t\tthis._setupCustom(view);\r\n\t\t\treturn [view, options]; \r\n\t\t}\r\n\t},\r\n\t_setupCustom(view){\r\n\t\treturn this.setupCustom(view);\r\n\t},\r\n\tsetupCustom: view => view,\r\n\taddChildViews(children = []){\r\n\t\tif (!children.length) { return; }\r\n\r\n\t\tlet awaitingRender = false;\r\n\t\tlet rendered = [];\r\n\t\twhile(children.length) {\r\n\r\n\t\t\tlet args = children.pop();\r\n\t\t\tif (!args) { continue; }\r\n\r\n\t\t\tif (!_.isArray(args)) {\r\n\t\t\t\targs = [args, { index: 0 }];\r\n\t\t\t}\r\n\r\n\t\t\tlet [ view, index, options = {} ] = args;\r\n\t\t\tif (_.isObject(index)) {\r\n\t\t\t\toptions = index;\r\n\t\t\t\tindex = undefined;\r\n\t\t\t}\r\n\t\t\tif (index != null && !('index' in options)) {\r\n\t\t\t\toptions.index = index;\r\n\t\t\t}\r\n\t\t\toptions.preventRender = !!children.length;\r\n\t\t\tif (!isView(view)) { continue; }\r\n\r\n\t\t\tthis.addChildView(view, options);\r\n\t\t\trendered.push(view);\r\n\t\t\tawaitingRender = options.preventRender;\r\n\t\t}\r\n\t\tif (awaitingRender) {\r\n\t\t\tthis.sort();\r\n\t\t}\r\n\t\treturn rendered;\r\n\t},\r\n}, { CustomsMixin: true });\r\n","export default Base => Base.extend({\r\n\tfetchNextEdge: 'bottom',\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tlet scrollEdge = this.getOption('fetchNextEdge');\r\n\t\tif (scrollEdge) {\r\n\t\t\tlet event = scrollEdge + ':edge';\r\n\t\t\tthis.addScrollEvents({\r\n\t\t\t\t[event](){\r\n\t\t\t\t\tthis.fetchNext({ onlyIfNotFetching: true }).then(() => {\r\n\t\t\t\t\t\tthis.clearScrollEdges();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t});\r\n\t\t\tlet collection = this.getCollection();\r\n\t\t\tif(collection){\r\n\t\t\t\tthis.listenTo(collection,'query:change',() => {\r\n\t\t\t\t\tthis.scrollToStart();\r\n\t\t\t\t\tthis.clearScrollEdges();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tfetchNext({ onlyIfNotFetching }={}){\r\n\t\tlet collection = this.getCollection();\r\n\t\tif(!collection) return Promise.resolve();\r\n\t\tif (onlyIfNotFetching && collection.isFetching()) return Promise.resolve(collection);\r\n\t\treturn collection.fetchNext ? collection.fetchNext() : collection.fetch();\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\t\r\n\t\tthis.on({\r\n\t\t\trequest(){\r\n\t\t\t\tthis._isFetching = true;\r\n\t\t\t},\r\n\t\t\tsync(){\r\n\t\t\t\tthis._isFetching = false;\r\n\t\t\t\tthis._isFetched = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tBase.apply(this, arguments);\r\n\t},\r\n\tisFetching(){\r\n\t\treturn this._isFetching === true;\r\n\t},\r\n\tisFetched(){\r\n\t\treturn this._isFetched === true;\r\n\t},\r\n\tconcurrentFetch: 'first',\r\n\tfetch({ concurrent } = {}) {\r\n\t\tif (concurrent == null) {\r\n\t\t\tconcurrent = this.concurrentFetch;\r\n\t\t}\r\n\r\n\t\tif (concurrent === 'first') {\r\n\t\t\tif (this._fetchingPromise) {\r\n\t\t\t\treturn this._fetchingPromise;\r\n\t\t\t} else {\r\n\t\t\t\tlet promise = this._fetchingPromise = Base.prototype.fetch.apply(this, arguments);\r\n\t\t\t\tpromise.then(() => {\r\n\t\t\t\t\tdelete this._fetchingPromise;\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tdelete this._fetchingPromise;\r\n\t\t\t\t});\r\n\t\t\t\treturn promise;\t\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet promise = this._fetchingPromise = Base.prototype.fetch.apply(this, arguments);\r\n\t\t\treturn promise;\r\n\t\t}\r\n\t},\r\n\tfetchIfNot(opts){\r\n\t\tif(this.isFetched()){\r\n\t\t\treturn Promise.resolve();\r\n\t\t} else {\r\n\t\t\treturn this.fetch(_.extend({ concurrent: 'first', opts }));\r\n\t\t}\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nimport { isKnownCtor, mergeOptions, getOption } from 'bbmn-utils';\r\n\r\nexport default Base => Base.extend({\r\n\r\n\tconstructor(opts){\r\n\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeChildrenable(opts);\r\n\r\n\t},\r\n\r\n\t_initializeChildrenable(opts){\r\n\t\tmergeOptions.call(this, opts, ['parent', 'root']);\r\n\t\tif (this.parent == null && this.root == null) \r\n\t\t\tthis.root = this;\r\n\t},\r\n\r\n\t//call this method manualy for initialize children\r\n\tinitializeChildren(){\r\n\t\tif (this._childrenInitialized) return;\r\n\r\n\t\tlet children = getOption(this, 'children');\r\n\t\tthis._children = [];\r\n\t\t_(children).each(child => this._initializeChild(child));\r\n\r\n\t\tthis._childrenInitialized = true;\r\n\r\n\t},\r\n\r\n\t_initializeChild(arg){\r\n\t\tlet Child;\r\n\t\tlet options = {};\r\n\r\n\t\tif (isKnownCtor(arg))\r\n\t\t\tChild = arg;\r\n\t\telse if(_.isFunction(arg)){\r\n\t\t\t\r\n\t\t\tlet invoked = arg.call(this, this);\r\n\t\t\treturn this._initializeChild(invoked);\r\n\r\n\t\t} else if (_.isObject(arg)) {\r\n\t\t\tChild = arg.Child;\r\n\t\t\t_.extend(options, _.omit(arg, 'Child'));\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t_.extend(options, getOption(this, 'childOptions'), { parent: this });\r\n\t\toptions = this.buildChildOptions(options);\r\n\t\t\r\n\t\tlet child = this.buildChild(Child, options);\r\n\t\tthis._children.push(child);\r\n\r\n\t},\r\n\r\n\tbuildChildOptions(options){\r\n\t\treturn options;\r\n\t},\r\n\tbuildChild(Child, options){\r\n\t\t!Child && (Child = getOption(this, 'defaultChildClass') || this.prototype.constructor);\r\n\t\treturn new Child(options);\r\n\t},\r\n\t_getChildren(items, opts = {}){\r\n\t\tlet { exclude, filter, map } = opts;\r\n\r\n\t\tif(exclude != null && !_.isArray(exclude))\r\n\t\t\topts.exclude = [exclude];\r\n\r\n\t\tif(!_.isFunction(filter))\r\n\t\t\tdelete opts.filter;\r\n\r\n\t\tlet result = [];\r\n\t\tlet force = opts.force;\r\n\t\t_(items).each((item, index) => {\r\n\r\n\t\t\tif(!force && !this._childFilter(item, index, opts))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(_.isFunction(map))\r\n\t\t\t\titem = map(item);\r\n\r\n\t\t\titem && result.push(item);\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\t_childFilter(item, index, opts = {}){\r\n\t\t\r\n\t\tif(opts.force) return item;\r\n\r\n\t\tlet { exclude, filter } = opts;\r\n\r\n\t\tif(_.isFunction(this.childFilter) && !this.childFilter(item, index, opts))\r\n\t\t\treturn;\r\n\r\n\t\tif(_.isArray(exclude) && exclude.indexOf(item) >= 0)\r\n\t\t\treturn;\r\n\r\n\t\tif(_.isFunction(filter) && !filter.call(this, item, index, opts))\r\n\t\t\treturn;\r\n\r\n\t\treturn item;\r\n\t},\r\n\tchildFilter: false,\r\n\tgetChildren(opts = {}){\r\n\t\tlet children = [].slice.call(this._children || []);\r\n\t\topts.reverse && children.length > 1 && children.reverse();\t\t\r\n\t\treturn this._getChildren(children, opts);\r\n\t},\r\n\tgetAllChildren(opts = {}){\r\n\r\n\t\tlet { includeSelf, map, reverse } = opts;\r\n\t\tlet options = _.omit(opts, 'includeSelf', 'map');\r\n\r\n\r\n\t\tlet children = this.getChildren(options);\r\n\t\tlet result = _(children).chain()\r\n\t\t\t.map(child => {\r\n\t\t\t\tlet children = child.getAllChildren(options);\r\n\t\t\t\treturn reverse ? [children, child] : [child, children];\r\n\t\t\t})\r\n\t\t\t.flatten()\r\n\t\t\t.value();\r\n\r\n\t\tif (includeSelf) {\r\n\t\t\tlet method = reverse ? 'push' : 'unshift';\r\n\t\t\tresult[method](this);\r\n\t\t}\r\n\t\t\r\n\t\tif (_.isFunction(map)) {\r\n\t\t\treturn _(result).chain().map(map).filter(f => !!f).value();\r\n\t\t} else {\t\t\t\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetParent(){\r\n\t\treturn this.parent;\r\n\t}\r\n\r\n\r\n\r\n}, { ChildrenableMixin: true });\r\n","import { betterResult, isCollection, isModel, isModelClass, isCollectionClass, clone } from 'bbmn-utils';\r\nimport { Model, Collection } from 'bbmn-core';\r\nimport _ from 'underscore';\r\nexport default Base => Base.extend({\r\n\t\r\n\t// usage:\r\n\t// model.entity('users');\r\n\tentity(key, options){\r\n\t\treturn this._getNestedEntity(key, options);\r\n\t},\r\n\r\n\t// override this if you need to do something with just created entity\r\n\t// by default here is settled change handlers\r\n\tsetupNestedEntity(context){\r\n\t\tif (!context.entity) return;\r\n\t\tthis._setNestedEntityHandlers(context);\r\n\t\tthis._setNestedEntityParent(context.entity, context.parentKey);\r\n\t},\r\n\r\n\t_getNestedEntity(key, options){\r\n\t\t//get sure there is a nestedEntities store initialized;\r\n\t\tthis._initEntitiesStore();\r\n\t\t// compiling passed `nestedEntities` contexts, occurs only at first call\r\n\t\tthis._initOwnEntities();\r\n\t\t\r\n\t\tlet context = this._nestedEntities[key];\r\n\t\tif (!context) { return; }\r\n\t\tif (!context.entity && !context._compiled) {\r\n\t\t\tcontext.entity = this._buildNestedEntity(context, options);\r\n\t\t\tif (context.entity) {\r\n\t\t\t\tthis.setupNestedEntity(context);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn context.entity;\r\n\t},\r\n\t_buildNestedEntity(context, options){\r\n\t\tlet data = this.get(context.name);\r\n\t\tif (_.isFunction(context.build)) {\r\n\t\t\tcontext.entity = context.build.call(this, data, context, this);\r\n\t\t} else {\r\n\t\t\tdata = data || context.data;\r\n\t\t\tlet args = context.args;\r\n\t\t\tif (!args) {\r\n\t\t\t\targs = [data];\r\n\t\t\t\tif (context.parse) {\r\n\t\t\t\t\tif(!options) options = {};\r\n\t\t\t\t\tif(!('parse' in options)){\r\n\t\t\t\t\t\toptions.parse = context.parse;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(options || context.options) {\r\n\t\t\t\t\targs.push(_.extend({}, context.options, options));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcontext.entity = new context.class(...args);\r\n\t\t}\r\n\t\tcontext._compiled;\r\n\t\treturn context.entity;\r\n\t},\r\n\t_initOwnEntities(){\r\n\t\tif (this._nestedEntitiesInitialized) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet memo = this._nestedEntities;\r\n\t\tlet additional = this._runtimeNestedEntities;\r\n\t\t_.each(additional, context => {\r\n\t\t\tif (_.isFunction(context)) {\r\n\t\t\t\tcontext = context.call(this);\r\n\t\t\t}\r\n\t\t\tif (!context.name) return;\r\n\t\t\tif (!isModelClass(context.class) && !isCollectionClass(context.class) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tmemo[context.name] = clone(context, { functions: true });\r\n\t\t});\r\n\r\n\t\tlet compiled = betterResult(this, 'nestedEntities', { args: [ this ] });\r\n\t\t_.each(compiled, (context, key) => {\r\n\t\t\t// handle the case where its a runtime function or class definition\r\n\t\t\tcontext = betterResult({ context }, 'context', { args: [key] });\r\n\t\t\tif (isModelClass(context) || isCollectionClass(context) ) {\r\n\t\t\t\tcontext = {\r\n\t\t\t\t\tclass: context,\r\n\t\t\t\t};\r\n\t\t\t} \r\n\t\t\t// when its just a property name, trying to determine type of data and use default class\r\n\t\t\telse if (_.isString(context)) {\r\n\t\t\t\tcontext = {\r\n\t\t\t\t\tname: context\r\n\t\t\t\t};\r\n\t\t\t} else if (!_.isObject(context)) {\r\n\t\t\t\tcontext = {};\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tlet name = context.name || (_.isString(key) && key || undefined);\r\n\t\t\t\r\n\t\t\tif (!_.isString(name)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!context.name) {\r\n\t\t\t\tcontext.name = name;\r\n\t\t\t}\r\n\r\n\t\t\tif(!context.class) {\r\n\t\t\t\tlet data = this.get(context.name);\r\n\t\t\t\tif (_.isArray(data)) {\r\n\t\t\t\t\tcontext.class = this.NestedCollectionClass || Collection;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontext.class = this.NestedModelClass || Model;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tmemo[name] = clone(context, { functions: true });\r\n\r\n\t\t});\r\n\r\n\t\tthis._nestedEntitiesInitialized = true;\r\n\t},\r\n\t_initEntitiesStore(){\r\n\t\tif(!_.has(this, '_nestedEntities')){\r\n\t\t\tthis._nestedEntities = {};\r\n\t\t\tthis._runtimeNestedEntities = [];\r\n\t\t}\r\n\t},\r\n\tregisterNestedEntity(name, context){\r\n\t\tthis._initEntitiesStore();\r\n\t\tif (this._nestedEntitiesInitialized) {\r\n\t\t\tthrow new Error('its too late to register nestedEntities, they already initialized');\r\n\t\t}\t\t\r\n\t\tif(!name) {\r\n\t\t\tthrow new Error('Name must be provided');\r\n\t\t}\r\n\t\tlet toAdd;\r\n\t\tif (_.isFunction(context)) {\r\n\t\t\tlet wrapper = function() {\r\n\t\t\t\tlet contextInvoked = context.call(this);\r\n\t\t\t\tif (!_.isObject(contextInvoked)) {\r\n\t\t\t\t\tthrow new Error('Context must be an object with name and class properties');\r\n\t\t\t\t}\r\n\t\t\t\tcontextInvoked.name = name;\r\n\t\t\t\treturn contextInvoked;\r\n\t\t\t};\r\n\t\t\ttoAdd = wrapper;\r\n\t\t} else if(_.isObject(context)) {\r\n\t\t\tcontext.name = name;\r\n\t\t\ttoAdd = context;\r\n\t\t}\r\n\t\tif (toAdd == null) {\r\n\t\t\tthrow new Error('nestedEntity Context undefined and failed to register');\r\n\t\t}\r\n\t\tthis._runtimeNestedEntities.push(toAdd);\r\n\t},\r\n\t_setNestedEntityHandlers(context){\r\n\t\tlet { name, entity } = context;\r\n\t\tlet entityChangeEvents = 'change';\r\n\r\n\t\tif (isCollection(entity)) {\r\n\t\t\tentityChangeEvents += ' update reset';\r\n\t\t}\r\n\r\n\t\t// if entity get changed outside we should keep in sync this model property value\r\n\t\tif(!context.onEntityChange){\r\n\t\t\tcontext.onEntityChange = (instance, { changeInitiator } = {}) => {\r\n\t\t\t\t\r\n\t\t\t\tif (changeInitiator == this) return;\r\n\r\n\t\t\t\tchangeInitiator == null && (changeInitiator = entity);\r\n\r\n\t\t\t\tlet json = entity.toJSON();\t\t\t\t\r\n\t\t\t\tif (context.saveOnChange && !this.isNew()) {\r\n\t\t\t\t\tthis.save(name, json, { changeInitiator });\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.set(name, json, { changeInitiator });\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.listenTo(entity, entityChangeEvents, context.onEntityChange);\r\n\r\n\t\t// if this model property get changed outside we should keep in sync our nested entity\r\n\t\tif(!context.onPropertyChange) {\r\n\t\t\tcontext.onPropertyChange = (instance, _newvalue, { changeInitiator }) => {\r\n\t\t\t\tif (changeInitiator == this) return;\r\n\t\t\t\tchangeInitiator == null && (changeInitiator = this);\r\n\t\t\t\tlet defaultValue = isCollectionClass(context.class) ? [] : {};\r\n\t\t\t\tlet val = this.get(name) || defaultValue;\r\n\t\t\t\tif (isModel(entity) && changeInitiator != entity) {\r\n\t\t\t\t\tlet unset = _.reduce(entity.attributes, (memo, _val, key) => {\r\n\t\t\t\t\t\tif(key in val) return memo;\r\n\t\t\t\t\t\tmemo[key] = undefined;\r\n\t\t\t\t\t\treturn memo;\r\n\t\t\t\t\t}, {});\r\n\t\t\t\t\tentity.set(_.extend({}, val, unset), { changeInitiator });\r\n\t\t\t\t\tentity.set(unset, { unset: true, silent: true });\r\n\r\n\t\t\t\t} else if( isCollection(entity) && changeInitiator != entity) {\r\n\r\n\t\t\t\t\tentity.set(val, { changeInitiator });\r\n\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.on('change:' + name, context.onPropertyChange);\r\n\t},\r\n\t_setNestedEntityParent(entity, parentKey){\r\n\t\tparentKey || (parentKey = 'parent');\r\n\t\tentity[parentKey] = this;\r\n\t},\r\n\t_unsetNestedEntityParent(entity, parentKey){\r\n\t\tparentKey || (parentKey = 'parent');\r\n\t\tdelete entity[parentKey];\r\n\t},\r\n\tdestroy(){\r\n\t\tthis.dispose({ destroying: true });\r\n\t\tlet destroy = Base.prototype.destroy;\r\n\t\treturn destroy && destroy.apply(this, arguments);\r\n\t},\r\n\tdispose(opts){\r\n\t\tthis._disposeEntities(opts);\r\n\t\tlet dispose = Base.prototype.dispose;\t\t\r\n\t\treturn dispose && dispose.apply(this, arguments);\r\n\t},\r\n\t_disposeEntities(opts){\r\n\t\t_.each(this._nestedEntities, context => this._disposeEntity(context, opts));\r\n\t\tdelete this._nestedEntities;\r\n\t},\r\n\t_disposeEntity({ entity, name, onEntityChange, onPropertyChange, parentKey } = {}, { destroying } = {}){\r\n\t\tthis.stopListening(entity, null, onEntityChange);\r\n\t\tthis.off('change:'+ name, onPropertyChange);\r\n\t\tthis._unsetNestedEntityParent(entity, parentKey);\r\n\t\tlet method = destroying ? 'destroy' : 'dispose';\r\n\t\tentity[method] && entity[method]();\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nimport { betterResult as result, getOption, mergeOptions } from 'bbmn-utils';\r\n\r\n// previous version, deprecated\r\nconst Mixin = Base => Base.extend({\r\n\r\n\t//property first approach\r\n\tgetProperty(key, opts){\r\n\t\t\r\n\t\tlet defaultGetArguments = result(this, '_getPropertyArguments', { args:[this], default:[this] });\r\n\t\tlet options = _.extend({\r\n\t\t\tdeep: Mixin.defaults.deep,\r\n\t\t\tforce: Mixin.defaults.force,\r\n\t\t\targs: defaultGetArguments\r\n\t\t}, opts, {\r\n\t\t\tcontext: this,\r\n\t\t});\r\n\t\tlet { deep } = options;\r\n\r\n\t\tlet value = result(this, key, options);\r\n\t\tif (value == null && deep !== false) {\r\n\t\t\tvalue = result(this.options, key, options);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\r\n\t//options first approach\r\n\tgetOption(key, opts){\r\n\t\tlet defaultGetArguments = result(this, '_getOptionArguments', { args:[this], default:[this] });\r\n\t\tlet options = _.extend({\r\n\t\t\tdeep: Mixin.defaults.deep,\r\n\t\t\tforce: Mixin.defaults.force,\r\n\t\t\targs: defaultGetArguments\r\n\t\t}, opts);\r\n\r\n\t\treturn getOption(this, key, options);\r\n\t},\r\n\r\n\tmergeOptions(values = {}, keys = [], opts = {}){\r\n\t\t\r\n\t\tif(_.isString(keys))\r\n\t\t\tkeys = keys.split(/\\s*,\\s*/);\r\n\r\n\t\t_.each(keys, (key) => {\r\n\t\t\tconst option = result(values, key, _.extend({ force: false }, opts));\r\n\t\t\tif (option !== undefined) {\r\n\t\t\t\tthis[key] = option;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n}, {\r\n\tGetOptionMixin:true\r\n});\r\n\r\nMixin.defaults = {\r\n\tdeep: true,\r\n\tforce: true\r\n};\r\n\r\n//export default Mixin;\r\n\r\nexport default Base => Base.extend({\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\thasOption(key){\r\n\t\tlet opts = this.options || {};\r\n\t\treturn (opts[key] != null) || (this[key] != null);\r\n\t},\r\n\tmergeOptions\r\n});\r\n","\r\nimport { isModelClass, isCollectionClass, getByPath, betterResult } from 'bbmn-utils';\r\n\r\nfunction urlError() {\r\n\tthrow new Error('A \"url\" property or function must be specified');\r\n}\r\n\r\nfunction mixinError(){\r\n\tthrow new Error('This mixin can be applied only on Model or Collection');\r\n}\r\n\r\nfunction getUrlPattern(options){\r\n\tlet path = betterResult(this, 'urlPattern', { args: [this], default:'' });\r\n\treturn path.replace(/\\{([^}]+)\\}/g, (match, group) => {\r\n\t\tlet value = getByPath(this, group, options);\r\n\t\treturn value;\r\n\t});\r\n}\r\n\r\nconst ModelMixin = Base => Base.extend({\r\n\tgetUrlPattern,\r\n\tgetBaseUrl(){\r\n\t\tlet base =\r\n        betterResult(this, 'urlRoot', { args:[this]}) ||\r\n\t\tbetterResult(this.collection, 'url', { args:[this]}) ||\r\n\t\tthis.getUrlPattern({ includeModelProperty: true });\r\n\t\treturn base;\r\n\t},\r\n\turl(){\r\n\t\tlet base = this.getBaseUrl();\r\n\t\tif (!base) {\r\n\t\t\turlError();\r\n\t\t}\r\n\t\tif (this.isNew()) return base;\r\n\t\tvar id = this.get(this.idAttribute);\r\n\t\treturn base.replace(/[^/]$/, '$&/') + encodeURIComponent(id);  \r\n\t}\r\n});\r\n\r\n\r\nconst CollectionMixin = Base => Base.extend({\r\n\turl(){\r\n\t\tif (this.urlPattern) {\t\t\t\r\n\t\t\treturn this.getUrlPattern();\r\n\t\t}\r\n\t},\r\n\tgetUrlPattern\r\n});\r\n\r\n\r\nexport default Base => {\r\n\r\n\tconst mixin = isModelClass(Base) ? ModelMixin(Base)\r\n\t\t: isCollectionClass(Base) ? CollectionMixin(Base)\r\n\t\t\t: mixinError();\r\n\r\n\treturn mixin;\r\n\t\r\n};\r\n","import _ from 'underscore';\r\nexport default Base => Base.extend({\r\n\t/*\r\n\t\r\n\trenderOnModelChange: false,\r\n\trefreshOnModelChange: false,\r\n\ttriggerRefreshOnModelChange: false,\r\n\tinvokeOnModelChange: true,\t\r\n\r\n\t*/\r\n\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initRenderOnModelChange();\r\n\t},\r\n\t_initRenderOnModelChange(){\r\n\t\tif (!this.model) return;\r\n\r\n\t\tlet shouldRender = this.getOption('renderOnModelChange', { args: [this]});\r\n\t\tlet shouldRefresh = this.getOption('refreshOnModelChange', { args: [this]});\r\n\t\tlet shouldTriggerRefresh = this.getOption('triggerRefreshOnModelChange', { args: [this]});\r\n\t\tlet shouldInvoke = this.getOption('invokeOnModelChange', { args: [this]});\r\n\r\n\t\tthis.listenTo(this.model, 'before:destroy', () => this.stopListening(this.model));\r\n\t\tthis.listenTo(this.model, 'change', () => {\r\n\r\n\t\t\tif (shouldRefresh && _.isFunction(this.refresh)) {\r\n\t\t\t\tthis.refresh();\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldTriggerRefresh) {\r\n\t\t\t\tthis.trigger('refresh');\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldInvoke && _.isFunction(this.onModelChange)) {\r\n\t\t\t\tthis.onModelChange();\r\n\t\t\t}\r\n\r\n\t\t\tif (shouldRender) {\r\n\t\t\t\tthis.render();\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\r\n\t}\r\n});\r\n","//import getOptionMixin from './get-option/index.js';\r\nimport improvedFetchMixin from './improved-fetch/index.js';\r\nimport childrenableMixin from './childrenable/index.js';\r\nimport nestedEntitiesMixin from './nested-entities';\r\nimport optionsMixin from './options';\r\nimport urlPatternMixin from './url-pattern';\r\n\r\nexport { default as renderOnModelChangeMixin } from './render-on-model-change';\r\n\r\nexport {\r\n\toptionsMixin, improvedFetchMixin, childrenableMixin, nestedEntitiesMixin, urlPatternMixin\r\n};\r\n","import _ from 'underscore';\r\nexport default function getNestedResult(value, context, schema) {\r\n\treturn value != null \r\n\t\t&& _.isFunction(schema.nested) \r\n\t\t&& schema.nested(value, context);\r\n}\r\n","import _ from 'underscore';\r\nexport default function getPropertySchema(model, key)\r\n{\r\n\tif (_.isFunction(model.getPropertySchema)) {\r\n\t\treturn model.getPropertySchema(key);\r\n\t} else {\r\n\t\treturn {};\r\n\t}\r\n}\r\n","import _ from 'underscore';\r\nexport default function getDisplayConfig(key, model, schema){\r\n\tif (key == null) return {};\r\n\treturn (_.isFunction(model.getPropertyDisplayConfig) && model.getPropertyDisplayConfig(key))\r\n\t\t|| (schema && schema.display) || {};\r\n}\r\n","import _ from 'underscore';\r\nimport { Model } from 'bbmn-core';\r\nimport { getByPath } from 'bbmn-utils';\r\n\r\nimport getNestedResult from './get-nested-result.js';\r\nimport getPropertySchema from './get-property-schema.js';\r\nimport getDisplayConfig from './get-display-config.js';\r\n\r\n\r\nexport default Base => {\r\n\tconst originalGet = Model.prototype.get;\r\n\tconst Mixed = Base.extend({\r\n\t\tgetByPath(key){\r\n\t\t\tif(key.indexOf('.') > -1)\r\n\t\t\t\treturn getByPath(this, key);\r\n\t\t\telse\r\n\t\t\t\treturn originalGet.call(this, key);\r\n\t\t},\r\n\t\tget(key, opts = {}){\r\n\t\t\tif(key == null || key == '') return;\t\r\n\t\t\t\r\n\t\t\tlet value;\r\n\t\t\tif('value' in opts) {\r\n\t\t\t\tvalue = opts.value;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = opts.byPath !== false ? this.getByPath.call(this, key) : originalGet.call(this, key);\r\n\t\t\t}\r\n\r\n\t\t\tif (!_.size(opts)) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tlet prop = getPropertySchema(this, key);\r\n\t\t\tlet result = opts.nested && getNestedResult(value, this, prop);\r\n\t\t\tif (result != null) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tif(_.isFunction(opts.transform) && !opts.raw) {\r\n\t\t\t\tvalue = opts.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif(_.isFunction(prop.transform) && !opts.raw){\r\n\t\t\t\tvalue = prop.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif(opts.display === true){\r\n\r\n\t\t\t\tlet display = getDisplayConfig(key, this, prop);\r\n\r\n\t\t\t\tif(opts.alternative){\r\n\t\t\t\t\tvalue = _.isFunction(display.alternative) && display.alternative.call(this, value, _.extend({},opts,prop), this);\r\n\t\t\t\t}\r\n\t\t\t\telse if(_.isFunction(display.transform)) {\r\n\t\t\t\t\tvalue = display.transform.call(this, value, opts, this);\r\n\t\t\t\t}\r\n\t\t\t\tif(display.ifEmpty && (value == null || value === ''))\r\n\t\t\t\t\treturn display.ifEmpty;\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tdisplay(key, opts = {}){\r\n\t\t\t_.extend(opts, { display:true });\r\n\t\t\treturn this.get(key, opts);\r\n\t\t},\r\n\t\tpropertyName(key) {\r\n\t\t\tlet prop = getPropertySchema(this, key);\r\n\t\t\tlet display = getDisplayConfig(key, this, prop);\r\n\t\t\treturn display.label || key;\r\n\t\t}\r\n\t});\r\n\r\n\treturn Mixed;\r\n};\r\n","import _ from 'underscore';\r\nimport { betterResult } from 'bbmn-utils';\r\nexport default Base => Base.extend({\r\n\tdefaultWait: false,\r\n\tsaveReturnPromise: false,\r\n\tpatchInsteadSave: false,\r\n\tsave(key, val, options){\r\n\t\tlet attrs;\r\n\t\tif (key == null || typeof key === 'object') {\r\n\t\t\tattrs = key;\r\n\t\t\toptions = val;\r\n\t\t} else {\r\n\t\t\t(attrs = {})[key] = val;\r\n\t\t}\r\n\t\toptions || (options = {});\r\n\t\tif(!_.has(options, 'wait')){\r\n\t\t\toptions.wait = this.defaultWait;\r\n\t\t}\r\n\t\tif(!_.has(options, 'patch')) {\r\n\t\t\toptions.patch = this.patchInsteadSave;\r\n\t\t}\r\n\r\n\t\tif(options.addToUrl){\r\n\t\t\tlet url = betterResult(this, 'url', { args: [ options ] });\r\n\t\t\tif (url) {\r\n\t\t\t\turl += '/' + options.addToUrl;\r\n\t\t\t\toptions.url = url;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\t\tconst save = Base.prototype.save.call(this, attrs, options);\r\n\t\tif (!this.saveReturnPromise) {\r\n\t\t\treturn save;\r\n\t\t}\r\n\r\n\t\tif (save && _.isFunction(save.then)) {\r\n\t\t\treturn save;\r\n\t\t}\r\n\t\tif (!save) {\r\n\t\t\treturn Promise.reject(save);\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve(save);\r\n\t\t}\r\n\t}\r\n});\r\n","import { buildViewByKey } from 'bbmn-utils';\r\nexport default Base => Base.extend({\r\n\tbuildViewByKey(...args){\r\n\t\treturn buildViewByKey.call(this, ...args);\r\n\t},\r\n});\r\n","import { betterResult } from 'bbmn-utils';\r\nimport _ from 'underscore';\r\n\r\nconst defaultCssConfig = {\r\n\tbeforeRender: true,\r\n\tmodelChange: true,\r\n\trefresh: true,\r\n};\r\n\r\nexport default (Base) => Base.extend({\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._setupCssClassModifiers();\t\t\r\n\t},\r\n\t_initCssClassModifiers(){\r\n\t\tif (this.hasOwnProperty('cssClassModifiers')) { return; }\r\n\t\tlet modifiers = [];\r\n\t\tlet optsModifiers = betterResult(this.options || {}, 'cssClassModifiers', { args:[this.model, this], default: [] });\r\n\t\tlet propsModifiers = betterResult(this, 'cssClassModifiers', { args:[this.model, this], default: [] });\r\n\t\tmodifiers.push(...optsModifiers);\r\n\t\tmodifiers.push(...propsModifiers);\r\n\t\tthis.cssClassModifiers = modifiers;\r\n\t},\r\n\taddCssClassModifier(...modifiers){\r\n\t\tthis._initCssClassModifiers();\r\n\t\tthis.cssClassModifiers.push(...modifiers);\r\n\t},\r\n\trefreshCssClass(){\r\n\t\tlet className = this._getCssClassString();\r\n\t\tif(className == ''){\r\n\t\t\tthis.$el.removeAttr('class');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.$el.attr({\r\n\t\t\t\tclass: className\r\n\t\t\t});\r\n\t\t}\r\n\t},\t\r\n\r\n\t_getCssClassModifiers(){\r\n\t\tthis._initCssClassModifiers();\r\n\t\tlet className = betterResult(this, 'className', { args:[this.model, this], default: [] });\r\n\t\tlet modifiers = this.cssClassModifiers.concat([className]);\r\n\t\treturn modifiers;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassModifiers(){\r\n\t\treturn this._getCssClassModifiers();\r\n\t},\r\n\t_getCssClassString()\r\n\t{\r\n\t\tlet modifiers = this.getCssClassModifiers();\r\n\t\t\r\n\t\tlet classes = _(modifiers).reduce((hash, modifier) => {\r\n\t\t\tif(modifier == null || modifier === '') { return hash; }\r\n\t\t\tlet cls;\r\n\t\t\tif (_.isString(modifier)) {\r\n\t\t\t\tcls = modifier;\r\n\t\t\t} else if (_.isFunction(modifier)) {\r\n\t\t\t\tlet builded = modifier.call(this, this.model, this);\r\n\t\t\t\tcls = _.isString(builded) && builded || undefined;\r\n\t\t\t}\r\n\t\t\tcls && (hash[cls] = true);\r\n\t\t\treturn hash;\r\n\t\t}, {});\r\n\r\n\t\treturn _.keys(classes).join(' ');\r\n\r\n\t},\r\n\r\n\t_setupCssClassModifiers(){\r\n\r\n\t\tif(this._cssClassModifiersInitialized) return;\r\n\r\n\t\tlet cfg = this.getCssClassConfig();\r\n\t\tif(!cfg) return;\r\n\r\n\t\tlet events = this.getCssClassEvents(cfg);\r\n\t\t_(events).each((eventName) => this.on(eventName, this.refreshCssClass));\r\n\r\n\t\tif (cfg.modelChange && this.model) {\r\n\t\t\tthis.listenTo(this.model, 'change', this.refreshCssClass);\r\n\t\t}\r\n\r\n\t\tthis._cssClassModifiersInitialized = true;\r\n\t},\r\n\t\r\n\t_getCssClassConfig(){\r\n\t\tlet cfg = _.extend({}, defaultCssConfig, this.getOption('cssClassConfig'));\r\n\t\tif(!cfg || _.size(cfg) == 0) return;\r\n\t\treturn cfg;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassConfig(){\r\n\t\treturn this._getCssClassConfig();\r\n\t},\r\n\r\n\t_getCssClassEvents(cfg){\r\n\t\tlet events = [].concat(cfg.events || []);\r\n\t\tif(cfg.refresh) events.push('refresh');\r\n\t\tif(cfg.beforeRender) events.push('before:render');\r\n\t\tevents = _(events).uniq();\r\n\t\treturn events;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassEvents(cfg){\r\n\t\treturn this._getCssClassEvents(cfg);\r\n\t}\r\n}, { CssClassModifiersMixin: true });\r\n","export default Base => Base.extend({\r\n\tdestroy(){\r\n\t\tif(this._isDestroyed || this._isDestroying) { return; }\r\n\t\tthis._isDestroying = true;\r\n\t\tBase.prototype.destroy.apply(this, arguments);\r\n\t\tdelete this._isDestroying;\r\n\t},\r\n\tisDestroyed(){\r\n\t\treturn this._isDestroyed || this._isDestroying;\r\n\t}\r\n}, { DestroyMixin: true });\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n\r\nconst defaultSelector = (name, prefix = '') => prefix + 'region-' + name;\r\n\r\nfunction defaultUpdateDom(name, $el)\r\n{\r\n\tlet selector = defaultSelector(name);\r\n\tlet element = $('<div>').addClass(selector);\r\n\t$el.append(element);\r\n\r\n\treturn '.' + selector;\r\n}\r\n\r\nexport default function buildRegionFunc(view, hash, context){\r\n\r\n\tlet { $el } = view;\t\r\n\tlet { autoCreateRegion } = context;\r\n\tlet { updateDom, name, el } = hash;\r\n\tlet regionEl;\r\n\t\r\n\tlet region = view.getRegion(name);\r\n\r\n\r\n\tif (el == null && autoCreateRegion !== false) {\r\n\r\n\t\tlet testEl = region && region.getOption('el',{ deep:false});\r\n\r\n\t\tif (!region || !testEl || !$el.find(testEl).length) {\r\n\r\n\t\t\tregionEl = defaultUpdateDom(name, $el);\r\n\r\n\t\t} \r\n\r\n\t} else if(_.isFunction(updateDom)) {\r\n\t\tupdateDom.call(view, $el, view);\r\n\r\n\t} \r\n\t\r\n\t\r\n\tif (!region) {\r\n\t\tlet definition = _.pick(hash, 'replaceElement', 'regionClass');\r\n\t\tdefinition.el = hash.el || regionEl;\r\n\t\tregion = view.addRegion(name, definition);\r\n\t}\r\n\r\n\r\n\treturn region;\r\n}\r\n","import _ from 'underscore';\r\nimport buildRegion from './build-region.js';\r\n\r\nexport default function normalizeNestedViewContextRegion(context) {\r\n\r\n\tlet { region } = context;\r\n\tlet regionName = (_.isString(region) && region) || context.regionName || context.name;\r\n\r\n\tif (_.isString(region) || region == null) {\r\n\t\tregion = {};\r\n\t} else if (_.isFunction(region)) {\r\n\t\tregion = region.call(this, context, this);\r\n\t}\r\n\r\n\tif (_.isObject(region)) {\r\n\r\n\t\tif(!region.name)\r\n\t\t\tregion.name = regionName;\r\n\t\tlet replaceElement = this.getOption('replaceNestedElement');\r\n\t\tcontext.region = _.extend({ replaceElement }, region);\r\n\t\tcontext.show = _.partial(buildRegion, this, context.region, context);\r\n\t}\r\n\treturn context;\r\n}\r\n","import _ from 'underscore';\r\nimport { betterResult as result } from 'bbmn-utils';\r\nimport { isView, isViewClass } from 'bbmn-core';\r\nimport normalizeRegion from './normalize-region.js';\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\tthis._nestedViews = {};\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis.initializeNestedViews();\r\n\t},\r\n\ttemplate: false,\r\n\r\n\tshowAllNestedViewsOnRender: false,\r\n\tshowNestedViewOnAdd: false,\r\n\treplaceNestedElement: true,\r\n\r\n\tinitializeNestedViews(){\r\n\t\tif (this._nestedViewsInitialized) return;\r\n\r\n\t\tif(this.getOption('showAllNestedViewsOnRender')) {\r\n\t\t\tthis.on('render', () => this.showAllNestedViews());\r\n\t\t}\r\n\r\n\t\tlet nesteds = this.getOption('nestedViews', { args:[this.model, this]});\r\n\t\t_(nesteds).each((context, index) => {\r\n\r\n\t\t\tlet name = _.isString(index) ? index : (context.name || _.uniqueId('nested'));\r\n\t\t\tthis.addNestedView(name, context);\r\n\r\n\t\t});\r\n\r\n\t\tthis._nestedViewsInitialized = true;\r\n\t},\r\n\t_normalizeNestedContext(name, context){\r\n\r\n\t\tif (isViewClass(context)) {\r\n\t\t\tlet View = context;\r\n\t\t\tcontext = {\r\n\t\t\t\tname, View\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t//unwrap to plain object\r\n\t\tif (_.isFunction(context)) {\r\n\t\t\tcontext = context.call(this, this.model, this);\r\n\t\t}\r\n\r\n\t\t//fix name if its not provided\r\n\t\tif (context.name == null) {\r\n\t\t\tcontext.name = name || _.uniqueId('nested');\r\n\t\t}\r\n\r\n\t\t//convert region to valid function\r\n\t\tcontext = normalizeRegion.call(this, context);\t\t\r\n\r\n\r\n\t\treturn context;\r\n\t},\r\n\t_createNestedContext(context){\r\n\t\tlet contexts = this.getNestedViewContext();\r\n\t\tcontexts[context.name] = context;\r\n\t},\r\n\r\n\taddNestedView(name, context){\r\n\r\n\t\tif (!_.isString(name) || name === '') {\r\n\t\t\tthrow new Error('addNestedView: first argument should be a string');\r\n\t\t}\r\n\r\n\t\tcontext = this._normalizeNestedContext(name, context);\r\n\t\tthis._createNestedContext(context);\r\n\t\tif(this.getOption('showNestedViewOnAdd') && this.isRendered()){\r\n\t\t\tthis.showNestedView(context);\r\n\t\t}\t\t\r\n\t},\r\n\r\n\tshowNestedView(name){\r\n\t\tlet region = this.getNestedViewRegion(name);\r\n\t\tlet view = region && this.buildNestedView(name);\r\n\t\tif (view) {\r\n\t\t\tregion.show(view);\r\n\t\t}\r\n\t},\r\n\tshowAllNestedViews(){\r\n\t\tlet contexts = this.getNestedViewContext();\r\n\t\t_(contexts).each(context => this.showNestedView(context));\r\n\t},\r\n\tgetNestedViewContext(name){\r\n\t\tlet contexts = this._nestedViews;\r\n\t\tif (arguments.length == 0)\r\n\t\t\treturn contexts;\r\n\t\telse\r\n\t\t\treturn contexts[name];\r\n\t},\r\n\r\n\r\n\tbuildNestedView(name){\r\n\r\n\t\tlet context = _.isObject(name) ? name\r\n\t\t\t: _.isString(name) ? this.getNestedViewContext(name)\r\n\t\t\t\t: null;\r\n\r\n\t\tif(!context) return;\r\n\t\tlet passedView = result(context, 'view', { context: this, args: [this, this.model] });\r\n\t\tif(_.isFunction(context.template))\r\n\t\t\treturn context.template;\r\n\t\telse if ( isView(passedView) ) {\r\n\t\t\treturn passedView;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet View = context.View;\r\n\t\t\tlet options = this.buildNestedViewOptions(result(context, 'options', { context: this, args: [this, this.model], default:{} }));\r\n\t\t\t\r\n\t\t\treturn new View(options);\r\n\t\t}\r\n\t},\r\n\tbuildNestedViewOptions(opts){\r\n\t\treturn opts;\r\n\t},\r\n\tgetNestedViewRegion(name){\r\n\t\tlet context = _.isObject(name) ? name\r\n\t\t\t: _.isString(name) ? this.getNestedViewContext(name)\r\n\t\t\t\t: null;\r\n\t\treturn context && _.result(context, 'show');\r\n\t}\r\n\t\r\n});\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\nimport { normalizeMethods } from 'backbone.marionette';\r\n\r\nimport { camelCase } from 'bbmn-utils';\r\n\r\nexport default Base => Base.extend({\r\n\ttriggerScrollEvents: false,\r\n\tscrollHandlingEnabled: true,\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeScrollHandler();\r\n\t\tthis.addCssClassModifier('scrollable');\r\n\t},\r\n\r\n\r\n\r\n\t_initializeScrollHandler(){\r\n\t\tif (!this.getOption('scrollHandlingEnabled')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet scrollDelegate = {\r\n\t\t\t'scroll': this._scrollHandler.bind(this)\r\n\t\t};\r\n\t\tthis.on({\r\n\t\t\t'attach': () => this.delegateEvents(scrollDelegate),\r\n\t\t\t'detach': () => this.undelegateEvents(scrollDelegate),\r\n\t\t});\r\n\t\tlet events = this.getOption('scrollEvents', { args: [ this ] });\r\n\t\tthis.addScrollEvents(events);\r\n\t},\r\n\tscrollToStart(){\r\n\t\tlet el = this.getScrollElement();\r\n\t\tel.scrollTop = 0;\r\n\t\tel.scrollLeft = 0;\r\n\t},\r\n\taddScrollEvents(events){\r\n\t\tlet hash = normalizeMethods(this, events);\r\n\t\tthis._scrollEvents = _.extend({}, this._scrollEvents, hash);\r\n\t},\r\n\r\n\t_scrollHandler(){\r\n\t\tlet info = this.getElementInfo();\r\n\t\tthis.tryRegisterEdgeHit(info, 'bottom');\r\n\t\tthis.tryRegisterEdgeHit(info, 'right');\r\n\t},\r\n\ttryRegisterEdgeHit(info, edge){\r\n\t\tlet scroll = info[camelCase('scroll', edge)];\r\n\t\tlet end = info[camelCase('scroll', edge, 'end')];\r\n\t\tif (scroll >= end && !this.isEdgeHited(edge)) {\r\n\t\t\tthis._triggerEdge(edge);\r\n\t\t}\r\n\t},\r\n\tedgeHitKey:'_scrollHandler.edge',\r\n\tisEdgeHited(edge){\r\n\t\tlet key = this.edgeHitKey + '.' + edge;\r\n\t\treturn this[key] === true;\r\n\t},\r\n\tsetEdgeHit(edge, arg = true){\r\n\t\tlet key = this.edgeHitKey + '.' + edge;\r\n\t\treturn this[key] = arg;\r\n\t},\r\n\tgetScrollElement(){\r\n\t\tif (!this._scrollElement) {\r\n\t\t\tlet el = this.getOption('scrollElement', { args: [ this ]});\r\n\t\t\tif(el instanceof Element){\r\n\t\t\t\tthis._scrollElement;\r\n\t\t\t} else if(el == null) {\r\n\t\t\t\tthis._scrollElement = this.el;\r\n\t\t\t} else if (el.jquery){\r\n\t\t\t\tthis._scrollElement = el[0];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._scrollElement;\r\n\t},\t\r\n\tgetElementInfo(){\r\n\t\tlet el = this.getScrollElement();\r\n\t\tlet $el = $(el);\r\n\t\tlet width = $el.outerWidth();\r\n\t\tlet height = $el.outerHeight();\r\n\t\tlet scrollBottomEnd = el.scrollHeight - Math.floor(height / 2);\r\n\t\tlet scrollRightEnd = el.scrollWidth - Math.floor(width / 2);\r\n\t\treturn {\r\n\t\t\twidth, height,\r\n\t\t\tscrollBottomEnd, scrollRightEnd,\r\n\t\t\tscrollBottom: el.scrollTop + height,\r\n\t\t\tscrollRight: el.scrollLeft + width,\r\n\t\t};\r\n\t},\r\n\r\n\tclearScrollEdges(){\r\n\t\tthis.setEdgeHit('bottom', false);\r\n\t\tthis.setEdgeHit('right', false);\r\n\t},\r\n\r\n\t_triggerEdge(edge){\r\n\t\tthis.setEdgeHit(edge);\r\n\t\tif(this._scrollEvents) {\r\n\t\t\tlet handler = this._scrollEvents[`${edge}:edge`];\r\n\t\t\thandler && handler.call(this);\r\n\t\t}\r\n\t\tif(this.getOption('triggerScrollEvents') != false) {\r\n\t\t\tthis.triggerMethod('scrolled:to:' + edge);\r\n\t\t}\r\n\t},\r\n\r\n});\r\n\r\n\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\nimport { Behavior } from 'backbone.marionette';\r\nimport { Collection } from 'bbmn-core';\r\n\r\n\r\n\r\n\r\nexport const SortableBehavior = Behavior.extend({\r\n\r\n\t//for move anchor, in our case whole view is anchor\r\n\tselector: '.sortable-anchor',\r\n\r\n\t// we have to know when childView is clicked for order\r\n\t// and when it mouse overed while ordering\r\n\tonAddChild(parent, view) {\r\n\r\n\t\tlet selector = this.getOption('selector');\r\n\r\n\t\t//in case if there is a special childNode as anchor\r\n\t\tview.$el.on('mousedown', selector, e => this.startDragSort(e,view));\t\t\t\r\n\t\tview.$el.on('mouseenter', e => this.handleMouseEnter(e, view));\r\n\r\n\t},\r\n\r\n\thandleMouseEnter(event, view){\r\n\t\tif (!this.orderingItem || this.orderingItem == view || view.getOption('notSortable')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.view.swapChildViews(this.orderingItem, view);\r\n\t\tthis.view.triggerMethod('drag:swap:views', this.orderingItem, view);\r\n\t},\r\n\r\n\tstartDragSort(event, child, touchable){\r\n\t\tthis.orderingItem = child;\r\n\t\t//mouse up can happens outside.\r\n\t\t\r\n\t\t$(document).one('mouseup', e => this.stopDragSort(e, touchable));\r\n\t\tthis.view.triggerMethod('before:drag:sort', child);\r\n\t},\r\n\tstopDragSort(){\r\n\t\tlet view = this.orderingItem;\r\n\t\tdelete this.orderingItem;\r\n\t\tthis.view.triggerMethod('drag:sort', view);\r\n\t},\r\n});\r\n\r\n\r\n\r\nexport const SortableModelBehavior = SortableBehavior.extend({\r\n\tinitialize(options){\r\n\t\tthis.mergeOptions(options, ['swapModels', 'property']);\r\n\t\tif (_.isString(this.swapModels)){\r\n\t\t\tthis.swapModels = this.view.getOption(this.swapModels);\r\n\t\t}\r\n\t\tif (_.isFunction(this.swapModels)) {\r\n\t\t\tthis.swapModels = this.swapModels.bind(this.view);\r\n\t\t} else if (this.property) {\r\n\t\t\tthis.swapModels = this.swapModelsProperty;      \r\n\t\t} else {\r\n\t\t\tdelete this.swapModels;\r\n\t\t}\r\n\t},\r\n\tswapModelsProperty(m1,m2){\r\n\t\tlet key = this.property;\r\n\t\tlet temp = m1.get(key);\r\n\t\tm1.set(key, m2.get(key));\r\n\t\tm2.set(key, temp);  \r\n\t},\r\n\tonDragSwapViews(v1,v2){\r\n\t\tif (!this.swapModels || !v1.model || !v2.model) return;\r\n\t\tthis.swapModels(v1.model, v2.model);\r\n\t},\r\n\tonBeforeDragSort(){\r\n\t\tthis.changedModels = new Collection();\r\n\t\tthis.listenTo(this.view.collection, 'change', this.storeChangedModel);\r\n\t},\r\n\tstoreChangedModel(model){\r\n\t\tthis.changedModels.add(model);\r\n\t},\r\n\tonDragSort(){\r\n\t\tthis.stopListening(this.view.collection, 'change', this.storeChangedModel);\r\n\t\t// do something here with changed models\r\n\t\tthis.view.triggerMethod('drag:sort:change', this.changedModels.models);\r\n\t},\r\n});\r\n","import $ from 'jquery';\r\nimport _ from 'underscore';\r\n\r\nlet shouldPreventMove = false;\r\nlet fakeListener = false;\r\n\r\nexport const preventCallback = event => {\r\n\tif (shouldPreventMove) {\r\n\t\tevent.preventDefault();\r\n\t}\r\n};\r\n\r\n// for canceling click after drag back to the clicked el\r\nfunction cancelMouseClick(e) {\r\n\te.stopPropagation(); // Stop the click from being propagated.\r\n\twindow.removeEventListener('click', cancelMouseClick, true); // cleanup\r\n}\r\n\r\n// for preventing touchmove after hold\r\nexport function setupTouchMovePrevent()\r\n{\r\n\tif (fakeListener) return;\r\n\r\n\tdocument.addEventListener('touchmove', preventCallback, { passive: false });\r\n\r\n\tfakeListener = true;\r\n\r\n}\r\n\r\nlet baseManipulatorEnter = (event, initialEl) => {\r\n\r\n\tlet touches = !!event.touches;\r\n\tlet target = event.target;\r\n\tif (touches) {\r\n\t\tlet touch = event.touches[0];\r\n\t\ttarget = document.elementFromPoint(touch.pageX, touch.pageY);\r\n\t}\r\n\tif (initialEl == target || initialEl.contains(target)) return;\r\n\r\n\t$(target).trigger('manipulator:enter');\r\n};\r\n\r\nexport function delayedTouchstart(touchstart, delay = 400) {\r\n\treturn function (event) {\r\n\t\t\r\n\t\t\r\n\r\n\t\tif (event.touches.length !== 1) { return; }\r\n\r\n\t\tlet el = event.target;\r\n\r\n\r\n\t\tvar heldItem = function () {\r\n\r\n\t\t\tel.removeEventListener('touchend', onReleasedItem);\r\n\t\t\tel.removeEventListener('touchmove', onReleasedItem);\r\n\r\n\r\n\t\t\t// preventing defalut touchmove\r\n\t\t\t// using fakeListener from setupTouchMovePrevent\r\n\t\t\t// and reverting value back after touch end\r\n\t\t\tshouldPreventMove = true;\r\n\t\t\tlet returnPreventMoveValue = () => {\r\n\t\t\t\tel.removeEventListener('touchend', returnPreventMoveValue);\t\r\n\t\t\t\tshouldPreventMove = false;\r\n\t\t\t};\r\n\r\n\r\n\t\t\tel.addEventListener('touchend', returnPreventMoveValue);\r\n\r\n\t\t\ttouchstart(event);\r\n\r\n\t\t};\r\n\r\n\t\tvar onReleasedItem = function () {\r\n\t\t\tel.removeEventListener('touchend', onReleasedItem);\r\n\t\t\tel.removeEventListener('touchmove', onReleasedItem);\r\n\t\t\tclearTimeout(timer);\r\n\t\t};\r\n\r\n\t\tvar timer = setTimeout(heldItem, delay);\r\n\t\tel.addEventListener('touchend', onReleasedItem);\r\n\t\tel.addEventListener('touchmove', onReleasedItem);\r\n\t};\r\n}\r\n\r\n\r\nexport function setupManipulatorEnter({ $el, onManipulatorEnter, onStart, onEnd, disableTouchScroll, selector, preventStart } = {}) {\r\n\r\n\tif (!fakeListener) {\r\n\t\tdocument.addEventListener('touchmove', preventCallback, { passive: false });\r\n\t\tfakeListener = true;\r\n\t}\r\n\r\n\tlet el = $el.get(0);\r\n\tlet manipulatorEnter = _.partial(baseManipulatorEnter, _, el);\r\n\tlet $doc = $(document);\r\n\tlet isOnStart = _.isFunction(onStart);\r\n\tlet isOnEnd = _.isFunction(onEnd);\r\n\tlet isDisableTouchScroll = _.isFunction(disableTouchScroll);\r\n\tlet isPreventStart = _.isFunction(preventStart);\r\n\r\n\tlet touchStart = () => {\r\n\r\n\t\tisOnStart && onStart();\r\n\t\tisDisableTouchScroll && disableTouchScroll();\r\n\t\t\r\n\t\tlet touchEnd = () => {\r\n\t\t\tdocument.removeEventListener('touchmove', manipulatorEnter);\r\n\t\t\tdocument.removeEventListener('touchend', touchEnd);\r\n\t\t\tisOnEnd && onEnd();\r\n\t\t};\r\n\r\n\t\tdocument.addEventListener('touchmove', manipulatorEnter, { passive: false });\r\n\t\tdocument.addEventListener('touchend', touchEnd, { passive: false });\r\n\r\n\t};\r\n\r\n\tel.addEventListener('touchstart', delayedTouchstart(touchStart), { passive: false });\r\n\t\r\n\t$el.on('mousedown', selector, (original) => {\r\n\t\tif(isPreventStart && preventStart()){\r\n\t\t\toriginal.preventDefault();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet stopHandlers = (event) => {\r\n\t\t\toriginal.preventDefault();\r\n\t\t\tevent.preventDefault();\r\n\t\t\t$doc.off('mouseenter', '*', manipulatorEnter);\r\n\t\t\t$el.off('mousemove', mouseStart);\r\n\t\t\tisOnEnd && onEnd();\r\n\t\t\treturn false;\r\n\t\t};\r\n\r\n\t\tlet mouseStart = () => {\r\n\t\t\t$el.one('mouseup', () => { \r\n\t\t\t\twindow.addEventListener('click', cancelMouseClick, true );\r\n\t\t\t});\r\n\t\t\tonStart && onStart();\r\n\t\t\t$doc.on('mouseenter', '*', manipulatorEnter);\r\n\t\t};\r\n\t\t$doc.one('mouseup', stopHandlers);\r\n\t\t$el.one('mousemove', mouseStart);\r\n\t});\r\n\t$el.on('manipulator:enter', onManipulatorEnter);\r\n}\r\n","import _ from 'underscore';\r\nimport { getOption } from 'bbmn-utils';\r\nimport { Behavior } from 'backbone.marionette';\r\nimport { setupManipulatorEnter } from './helpers';\r\n\r\nexport const InteractionBehavior = Behavior.extend({\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\tonAddChild(parent, view) {\r\n\r\n\t\tsetupManipulatorEnter({\r\n\t\t\t$el: view.$el,\r\n\r\n\t\t\tonManipulatorEnter: () => view.trigger('enter'),\r\n\t\t\tonStart: () => this.startInteraction(view),\r\n\t\t\tonEnd: () => this.endInteraction(view),\r\n\t\t\tselector: this.getOption('selector')\t\t\r\n\t\t});\t\t\r\n\t\tthis.listenTo(view, 'enter', () => this.viewEntered(view));\r\n\t\tthis.setupView(view);\r\n\t},\r\n\tviewEntered(view){\r\n\t\tthis.view.triggerMethod('view:entered', view);\r\n\t},\r\n\tstartInteraction(view){\r\n\t\tthis.dragging = view;\r\n\t\tview.dragging = true;\r\n\t\tlet options = this.getOption('interactionStartOptions');\r\n\t\tthis.view.triggerMethod('interaction:start', view, options);\r\n\t},\r\n\tendInteraction(view){\r\n\t\tdelete this.dragging;\r\n\t\tdelete view.dragging;\r\n\t\tlet options = this.getOption('interactionEndOptions');\r\n\t\tthis.view.triggerMethod('interaction:end', view, options);\r\n\t},\r\n\tsetupView: _.noop,\r\n});\r\n","import _ from 'underscore';\r\nimport { InteractionBehavior }  from './interaction-behavior';\r\nimport { Collection } from 'bbmn-core';\r\n\r\nexport const SwappableBehavior = InteractionBehavior.extend({\r\n\tinitialize(options){\r\n\t\tthis.initializeSwappable(options);\r\n\t},\r\n\r\n\tinitializeSwappable(options){\r\n\t\tthis.mergeOptions(options, ['swap', 'property', 'canBeSwapped']);\r\n\t\tif (_.isString(this.swap)){\r\n\t\t\tthis.swap = this.view.getOption(this.swap);\r\n\t\t}\r\n\t\tif (_.isFunction(this.swap)) {\r\n\t\t\tthis.swap = this.swap.bind(this.view);\r\n\t\t} else if (this.property) {\r\n\t\t\tthis.swap = this.swapModelsProperty;      \r\n\t\t} else {\r\n\t\t\tdelete this.swap;\r\n\t\t}\r\n\t\tthis.changedModels = new Collection();\r\n\t},\r\n\r\n\tinteractionEndOptions(){\r\n\t\treturn this.changedModels.models;\r\n\t},\r\n\r\n\r\n\tviewEntered(view){\r\n\t\tlet result = this.view.triggerMethod('view:entered', view);\r\n\t\tif (result === false) return;\r\n\t\tthis.swapViews(view);\r\n\t},\t\t\r\n\r\n\r\n\r\n\tstoreChangedModel(model){\r\n\t\tthis.changedModels.add(model);\r\n\t},\r\n\tcanBeSwapped(){\r\n\t\treturn true;\r\n\t},\r\n\r\n\tswapViews(entered){\r\n\r\n\t\tif (!this.canBeSwapped(entered)) return;\r\n\r\n\t\tthis.view.swapChildViews(this.dragging, entered);\r\n\t\t\r\n\t\tthis.dragging.model && this.storeChangedModel(this.dragging.model);\r\n\t\tentered.model && this.storeChangedModel(entered.model);\r\n\r\n\t\tthis.view.triggerMethod('swap:views', this.dragging, entered);\r\n\r\n\t},\r\n\tonSwapViews(one, two){\r\n\t\tthis.swap(one, two, this.getOption('swapOptions'));\r\n\t},\r\n\tswapModelsProperty(v1,v2, opts){\r\n\t\tif (this.property == null) return;\r\n\t\tlet key = this.property;\r\n\t\t\r\n\t\tif(v1.model == null || v2.model == null) return;\r\n\t\tlet m1 = v1.model;\r\n\t\tlet m2 = v2.model;\r\n\r\n\t\tlet temp = m1.get(key);\r\n\t\tm1.set(key, m2.get(key), opts);\r\n\t\tm2.set(key, temp, opts);\r\n\t},\t\r\n});\r\n","import _ from 'underscore';\r\nexport default Base => Base.extend({\r\n\tdefaultWait: false,\r\n\tcreateReturnPromise: false,\r\n\tcreate(model, options = {}){\r\n\t\tif(!_.has(options, 'wait')){\r\n\t\t\toptions.wait = this.defaultWait;\r\n\t\t}\r\n\t\tconst create = Base.prototype.create.call(this, model, options);\r\n\t\tif (!this.createReturnPromise) {\r\n\t\t\treturn create;\r\n\t\t}\r\n\r\n\t\tif (create && _.isFunction(create.then)) {\r\n\t\t\treturn create;\r\n\t\t}\r\n\t\tif (!create) {\r\n\t\t\treturn Promise.reject(create);\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve(create);\r\n\t\t}\r\n\t}\r\n});\r\n"],"names":["CollectionView","extend","apply","arguments","getOption","emptyView","_handleEmptyFetch","collection","length","listenToOnce","_renderChildren","Base","_emptyViewSelector","isFetching","isFetched","_","isFunction","fetching","fetched","wait","nodata","rebuildIndexes","models","index","model","view","_children","findByModel","_index","on","bind","_isModelView","isObject","prototype","_addChild","v1","v2","res","_hasUnrenderedViews","_addedViews","views","children","_views","triggerMethod","_showEmptyView","els","_getBuffer","_attachChildren","options","_isDestroyed","_isRendered","preventRender","render","hasIndex","isAddedToEnd","sort","_destroyEmptyView","isEmpty","EmptyView","_getEmptyView","_getEmptyViewOptions","_emptyViewInstance","addChildView","_removeChildView","_removeChild","destroy","CollectionViewMixin_4x","_collection","_initializeCustoms","_customs","arr","_getCustomsArray","push","unshift","optionsCustoms","betterResult","args","context","instanceCustoms","shouldMergeCustoms","add","concat","addCustom","_renderCustoms","each","_renderedCustoms","registered","_getCustoms","rawcustoms","getCustoms","customs","_prepareCustoms","addChildViews","renderCustoms","clone","reduce","array","item","_prepareCustom","buildCustom","arg","isArray","isView","isViewClass","call","childOptions","viewOptions","_setupCustom","setupCustom","awaitingRender","rendered","pop","undefined","CustomsMixin","scrollEdge","event","addScrollEvents","fetchNext","onlyIfNotFetching","then","clearScrollEdges","getCollection","listenTo","scrollToStart","Promise","resolve","fetch","_isFetching","_isFetched","concurrent","concurrentFetch","_fetchingPromise","promise","opts","_initializeChildrenable","parent","root","_childrenInitialized","_initializeChild","child","Child","isKnownCtor","invoked","omit","buildChildOptions","buildChild","constructor","items","exclude","filter","map","result","force","_childFilter","childFilter","indexOf","slice","reverse","_getChildren","includeSelf","getChildren","chain","getAllChildren","flatten","value","method","f","ChildrenableMixin","key","_getNestedEntity","entity","_setNestedEntityHandlers","_setNestedEntityParent","parentKey","_initEntitiesStore","_initOwnEntities","_nestedEntities","_compiled","_buildNestedEntity","setupNestedEntity","data","get","name","build","parse","class","_nestedEntitiesInitialized","memo","additional","_runtimeNestedEntities","isModelClass","isCollectionClass","functions","compiled","isString","NestedCollectionClass","Collection","NestedModelClass","Model","has","Error","toAdd","wrapper","contextInvoked","entityChangeEvents","isCollection","onEntityChange","instance","changeInitiator","json","toJSON","saveOnChange","isNew","save","set","onPropertyChange","_newvalue","defaultValue","val","isModel","unset","attributes","_val","silent","dispose","destroying","_disposeEntities","_disposeEntity","stopListening","off","_unsetNestedEntityParent","urlError","mixinError","getUrlPattern","path","default","replace","match","group","getByPath","ModelMixin","base","includeModelProperty","getBaseUrl","id","idAttribute","encodeURIComponent","CollectionMixin","urlPattern","mixin","_initRenderOnModelChange","shouldRender","shouldRefresh","shouldTriggerRefresh","shouldInvoke","refresh","trigger","onModelChange","getNestedResult","schema","nested","getPropertySchema","getDisplayConfig","getPropertyDisplayConfig","display","originalGet","Mixed","byPath","size","prop","transform","raw","alternative","ifEmpty","label","attrs","defaultWait","patch","patchInsteadSave","addToUrl","url","saveReturnPromise","reject","buildViewByKey","defaultCssConfig","_setupCssClassModifiers","hasOwnProperty","modifiers","optsModifiers","propsModifiers","cssClassModifiers","_initCssClassModifiers","className","_getCssClassString","$el","removeAttr","attr","_getCssClassModifiers","getCssClassModifiers","classes","hash","modifier","cls","builded","keys","join","_cssClassModifiersInitialized","cfg","getCssClassConfig","events","getCssClassEvents","eventName","refreshCssClass","modelChange","_getCssClassConfig","beforeRender","uniq","_getCssClassEvents","CssClassModifiersMixin","_isDestroying","DestroyMixin","defaultSelector","prefix","defaultUpdateDom","selector","element","$","addClass","append","buildRegionFunc","autoCreateRegion","updateDom","el","regionEl","region","getRegion","testEl","deep","find","definition","pick","addRegion","normalizeNestedViewContextRegion","regionName","replaceElement","show","partial","buildRegion","_nestedViews","initializeNestedViews","_nestedViewsInitialized","showAllNestedViews","nesteds","uniqueId","addNestedView","View","normalizeRegion","contexts","getNestedViewContext","_normalizeNestedContext","_createNestedContext","isRendered","showNestedView","getNestedViewRegion","buildNestedView","passedView","template","buildNestedViewOptions","_initializeScrollHandler","addCssClassModifier","scrollDelegate","_scrollHandler","delegateEvents","undelegateEvents","getScrollElement","scrollTop","scrollLeft","normalizeMethods","_scrollEvents","info","getElementInfo","tryRegisterEdgeHit","edge","scroll","camelCase","end","isEdgeHited","_triggerEdge","edgeHitKey","_scrollElement","Element","jquery","width","outerWidth","height","outerHeight","scrollBottomEnd","scrollHeight","Math","floor","scrollRightEnd","scrollWidth","setEdgeHit","handler","SortableBehavior","Behavior","startDragSort","e","handleMouseEnter","orderingItem","swapChildViews","touchable","document","one","stopDragSort","SortableModelBehavior","mergeOptions","swapModels","property","swapModelsProperty","m1","m2","temp","changedModels","storeChangedModel","shouldPreventMove","fakeListener","preventCallback","preventDefault","cancelMouseClick","stopPropagation","removeEventListener","baseManipulatorEnter","initialEl","touches","target","touch","elementFromPoint","pageX","pageY","contains","delayedTouchstart","touchstart","delay","heldItem","onReleasedItem","returnPreventMoveValue","addEventListener","timer","setTimeout","setupManipulatorEnter","onManipulatorEnter","onStart","onEnd","disableTouchScroll","preventStart","passive","manipulatorEnter","$doc","isOnStart","isOnEnd","isDisableTouchScroll","isPreventStart","touchStart","touchEnd","original","stopHandlers","mouseStart","InteractionBehavior","startInteraction","endInteraction","viewEntered","setupView","dragging","noop","SwappableBehavior","initializeSwappable","swap","swapViews","entered","canBeSwapped","two","create","createReturnPromise"],"mappings":"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"}