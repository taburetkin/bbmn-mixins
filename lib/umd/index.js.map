{"version":3,"file":"index.js","sources":["collection-view/empty-fetch/index.js","collection-view/empty-view/index.js","collection-view/improved-indexes/index.js","collection-view/next-collection-view/index.js","collection-view/customs/index.js","common/improved-fetch/index.js","common/childrenable/index.js","common/nested-entities/index.js","common/options/index.js","common/url-pattern/index.js","common/index.js","model/smart-get/get-nested-result.js","model/smart-get/get-property-schema.js","model/smart-get/get-display-config.js","model/smart-get/index.js","model/save-as-promise/index.js","view/build-view-by-key/index.js","view/css-class-modifiers/index.js","view/destroy-view/index.js","view/nested-views/build-region.js","view/nested-views/normalize-region.js","view/nested-views/index.js","collection/create-as-promise/index.js"],"sourcesContent":["export default CollectionView => CollectionView.extend({\r\n\tshouldHandleEmptyFetch: true, \r\n\tconstructor(){\r\n\t\tCollectionView.apply(this, arguments);\r\n\r\n\t\tthis.getOption('shouldHandleEmptyFetch') && this.emptyView\r\n\t\t\t&& this._handleEmptyFetch();\r\n\t},\r\n\t_handleEmptyFetch(){\r\n\t\tif (!this.collection || this.collection.length) { return; }\r\n\r\n\t\tthis.listenToOnce(this.collection, 'sync', \r\n\t\t\t() => !this.collection.length && this._renderChildren()\r\n\t\t);\r\n\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\n\r\nexport default Base => Base.extend({\r\n\temptyView(){\r\n\t\treturn this._emptyViewSelector({\r\n\t\t\tfetching: this.isFetching(),\r\n\t\t\tfetched: this.isFetched(),\r\n\t\t});\r\n\t},\r\n\tisFetching(){\r\n\t\treturn this.collection && _.isFunction(this.collection.isFetching) && this.collection.isFetching();\r\n\t},\r\n\tisFetched(){\r\n\t\treturn this.collection && _.isFunction(this.collection.isFetched) && this.collection.isFetched();\r\n\t},\r\n\t_emptyViewSelector({ fetching, fetched }={}){\r\n\t\tlet wait = this.getOption('waitView');\r\n\t\tlet nodata = this.getOption('noDataView');\r\n\t\tif (fetching && !fetched){\r\n\t\t\treturn wait || nodata;\r\n\t\t} else {\r\n\t\t\treturn nodata;\r\n\t\t}\r\n\t},\r\n});\r\n","function rebuildIndexes() {\r\n\tif (!this.getOption('shouldRebuildIndexes') || !this.collection) {\r\n\t\treturn;\r\n\t}\r\n\tlet models = this.collection.models;\r\n\tfor (let index = 0, length = models.length; index < length; index++) {\r\n\t\tlet model = models[index];\r\n\t\tlet view = this._children.findByModel(model);\r\n\t\tview && (view._index = index);\r\n\t}\r\n}\r\n\r\nexport default CollectionView => CollectionView.extend({\r\n\tshouldRebuildIndexes: true,\r\n\r\n\tconstructor() {\t\t\r\n\t\t\r\n\t\tCollectionView.apply(this, arguments);\r\n\t\tthis.on('before:sort', rebuildIndexes.bind(this));\r\n\t},\r\n\t_addChild(view, index){\r\n\t\tview._isModelView = arguments.length === 1;\r\n\t\tif (index != null) {\r\n\t\t\tview._index = index;\r\n\t\t}\r\n\t\treturn CollectionView.prototype._addChild.apply(this, arguments);\r\n\t},\r\n\t_viewComparator(v1,v2){\r\n\t\tlet res = v1._index - v2._index;\r\n\t\tif (res) return res;\r\n\t\tif (v1._isModelView) return 1;\r\n\t\treturn -1;\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nexport default CollectionView => CollectionView.extend({\r\n\t_renderChildren() {\r\n\t\t// If there are unrendered views prevent add to end perf\r\n\t\tif (this._hasUnrenderedViews) {\r\n\t\t\tdelete this._addedViews;\r\n\t\t\tdelete this._hasUnrenderedViews;\r\n\t\t}\r\n\r\n\t\tconst views = this._addedViews || this.children._views;\r\n\r\n\t\tthis.triggerMethod('before:render:children', this, views);\r\n\t\r\n\t\tthis._showEmptyView();\r\n\t\r\n\t\tconst els = this._getBuffer(views);\r\n\t\r\n\t\tthis._attachChildren(els, views);\r\n\t\r\n\t\tdelete this._addedViews;\r\n\t\r\n\t\tthis.triggerMethod('render:children', this, views);\r\n\t},\r\n\taddChildView(view, index, options = {}) {\r\n\t\tif (!view || view._isDestroyed) {\r\n\t\t\treturn view;\r\n\t\t}\r\n\r\n\t\tif (_.isObject(index)) {\r\n\t\t\toptions = index;\r\n\t\t}\r\n\r\n\t\t// If options has defined index we should use it\r\n\t\tif (options.index != null) {\r\n\t\t\tindex = options.index;\r\n\t\t}\r\n\r\n\t\tif (!this._isRendered && !options.preventRender) {\r\n\t\t\tthis.render();\r\n\t\t}\r\n\r\n\t\tthis._addChild(view, index);\r\n\r\n\t\tif (options.preventRender) {\r\n\t\t\tthis._hasUnrenderedViews = true;\r\n\t\t\treturn view;\r\n\t\t}\r\n\r\n\t\tconst hasIndex = (typeof index !== 'undefined');\r\n\t\tconst isAddedToEnd = !hasIndex || index >= this._children.length;\r\n\r\n\t\t// Only cache views if added to the end and there is no unrendered views\r\n\t\tif (isAddedToEnd && !this._hasUnrenderedViews) {\r\n\t\t\tthis._addedViews = [view];\r\n\t\t}\r\n\t\t\r\n\t\tif (hasIndex) {\r\n\t\t\tthis._renderChildren();\r\n\t\t} else {\r\n\t\t\tthis.sort();\r\n\t\t}\r\n\t\r\n\t\treturn view;\r\n\t},\r\n\t_showEmptyView() {\r\n\r\n\t\tthis._destroyEmptyView();\r\n\t\r\n\t\tif(!this.isEmpty()) { return; }\r\n\r\n\t\tconst EmptyView = this._getEmptyView();\t\r\n\t\tif (!EmptyView) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tconst options = this._getEmptyViewOptions();\r\n\t\tthis._emptyViewInstance = new EmptyView(options);\r\n\t\r\n\t\tthis.addChildView(this._emptyViewInstance, { preventRender: true, index: 0, });\r\n\t\r\n\t},\r\n\t_destroyEmptyView(){\r\n\t\tlet view = this._emptyViewInstance;\r\n\t\tif (!view) return;\r\n\t\r\n\t\tthis._removeChildView(view);\r\n\t\r\n\t\tthis._removeChild(view);\r\n\t\r\n\t\tview.destroy();\r\n\t\tdelete this._emptyViewInstance;\r\n\t},\r\n}, { CollectionViewMixin_4x: true});\r\n","import _ from 'underscore';\r\nimport { isView, isViewClass } from 'bbmn-core';\r\nimport { betterResult } from 'bbmn-utils';\r\n\r\nexport default Base => Base.extend({\r\n\t\r\n\trenderAllCustoms: false,\r\n\tshouldMergeCustoms: false,\r\n\trenderCollection: true,\r\n\r\n\tconstructor(){\r\n\t\tthis._customs = [];\t\t\r\n\t\tBase.apply(this, arguments);\r\n\t\tif (this.getOption('renderCollection') === false && this.collection) {\r\n\t\t\tthis._collection = this.collection;\r\n\t\t\tdelete this.collection;\r\n\t\t}\r\n\t\tthis._initializeCustoms();\r\n\t},\r\n\tgetCollection(){\r\n\t\treturn this.collection || this._collection;\r\n\t},\r\n\t_initializeCustoms(){\r\n\r\n\t\tlet optionsCustoms = betterResult(this.options, 'customs', { args: [this], context: this });\r\n\t\tlet instanceCustoms = betterResult(this, 'customs', { args: [this] });\r\n\t\tlet shouldMergeCustoms = this.getOption('shouldMergeCustoms');\r\n\t\tlet add;\r\n\t\tif (shouldMergeCustoms) {\r\n\t\t\tadd = (instanceCustoms || []).concat(optionsCustoms || []);\t\t\t\r\n\t\t} else {\r\n\t\t\tadd = instanceCustoms || optionsCustoms || [];\r\n\t\t}\r\n\t\tthis._customs.push(...add);\r\n\r\n\t\tif (this.getOption('renderAllCustoms')) {\r\n\t\t\tthis.on('render', this._renderCustoms);\r\n\t\t}\r\n\t},\r\n\trenderCustoms(){\r\n\t\tthis.triggerMethod('before:customs:render');\r\n\r\n\t\t_.each(this._renderedCustoms, view => view.destroy());\r\n\t\t\r\n\t\tlet rawcustoms = this.getCustoms();\r\n\t\tlet customs = this._prepareCustoms(rawcustoms);\r\n\r\n\t\tthis._renderedCustoms = this.addChildViews(customs);\r\n\r\n\t\tthis.triggerMethod('customs:render');\r\n\t},\r\n\t_renderCustoms(){\r\n\t\tif (!this.getOption('renderAllCustoms')) return;\r\n\t\tthis.renderCustoms();\r\n\t},\r\n\tgetCustoms() {\t\t\r\n\t\treturn _.clone(this._customs);\r\n\t},\r\n\t_prepareCustoms(rawcustoms){\r\n\t\treturn _.reduce(rawcustoms, (array, item) => {\r\n\t\t\tlet args = this._prepareCustom(item);\r\n\t\t\targs && (args = this.buildCustom(...args));\r\n\t\t\targs && array.push(args);\r\n\t\t\treturn array;\r\n\t\t},[]);\r\n\t},\r\n\t_prepareCustom(arg){\r\n\t\tif (_.isFunction(arg)) {\r\n\t\t\treturn this._prepareCustom(arg.call(this, this));\r\n\t\t} else if (_.isArray(arg)) {\r\n\t\t\treturn arg;\r\n\t\t} else {\r\n\t\t\treturn [arg, { index: 0 }];\r\n\t\t}\r\n\t},\r\n\tbuildCustom(view, options = {}){ \r\n\t\tif (isViewClass(view)) {\r\n\t\t\tlet childOptions = this.getOption('customViewOptions');\r\n\t\t\tview = new view(childOptions);\r\n\t\t} else if (_.isFunction(view)) {\r\n\t\t\tview = view.call(this, this);\r\n\t\t} else if(!isView(view) && _.isObject(view) && 'view' in view) {\r\n\t\t\tif(isView(view.view)) {\r\n\t\t\t\tif(_.isObject(view.options))\r\n\t\t\t\t\toptions = view.options;\r\n\t\t\t\tview = view.view;\r\n\t\t\t} else if(isViewClass(view.view)) {\r\n\t\t\t\tlet viewOptions = view.options;\r\n\t\t\t\tview = new view.view(viewOptions);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (isView(view)) {\r\n\t\t\tthis._setupCustom(view);\r\n\t\t\treturn [view, options]; \r\n\t\t}\r\n\t},\r\n\t_setupCustom(view){\r\n\t\tthis.setupCustom(view);\r\n\t},\r\n\tsetupCustom: _.noop,\r\n\taddChildViews(children = []){\r\n\t\tif (!children.length) { return; }\r\n\r\n\t\tlet awaitingRender = false;\r\n\t\tlet rendered = [];\r\n\t\twhile(children.length) {\r\n\r\n\t\t\tlet args = children.pop();\r\n\t\t\tif (!args) { continue; }\r\n\r\n\t\t\tif (!_.isArray(args)) {\r\n\t\t\t\targs = [args, { index: 0 }];\r\n\t\t\t}\r\n\r\n\t\t\tlet [ view, index, options = {} ] = args;\r\n\t\t\tif (_.isObject(index)) {\r\n\t\t\t\toptions = index;\r\n\t\t\t\tindex = undefined;\r\n\t\t\t}\r\n\t\t\tif (index != null && !('index' in options)) {\r\n\t\t\t\toptions.index = index;\r\n\t\t\t}\r\n\t\t\toptions.preventRender = !!children.length;\r\n\t\t\tif (!isView(view)) { continue; }\r\n\r\n\t\t\tthis.addChildView(view, options);\r\n\t\t\trendered.push(view);\r\n\t\t\tawaitingRender = options.preventRender;\r\n\t\t}\r\n\t\tif (awaitingRender) {\r\n\t\t\tthis.sort();\r\n\t\t}\r\n\t\treturn rendered;\r\n\t},\r\n}, { CustomsMixin: true });\r\n","\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\t\r\n\t\tthis.on({\r\n\t\t\trequest(){\r\n\t\t\t\tthis._isFetching = true;\r\n\t\t\t},\r\n\t\t\tsync(){\r\n\t\t\t\tthis._isFetching = false;\r\n\t\t\t\tthis._isFetched = true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t\r\n\t\tBase.apply(this, arguments);\r\n\t},\r\n\tisFetching(){\r\n\t\treturn this._isFetching === true;\r\n\t},\r\n\tisFetched(){\r\n\t\treturn this._isFetched === true;\r\n\t},\r\n\tconcurrentFetch: 'first',\r\n\tfetch({ concurrent } = {}) {\r\n\t\tif (concurrent == null) {\r\n\t\t\tconcurrent = this.concurrentFetch;\r\n\t\t}\r\n\r\n\t\tif (concurrent === 'first') {\r\n\t\t\tif (this._fetchingPromise) {\r\n\t\t\t\treturn this._fetchingPromise;\r\n\t\t\t} else {\r\n\t\t\t\tlet promise = this._fetchingPromise = Base.prototype.fetch.apply(this, arguments);\r\n\t\t\t\tpromise.then(() => {\r\n\t\t\t\t\tdelete this._fetchingPromise;\r\n\t\t\t\t}, () => {\r\n\t\t\t\t\tdelete this._fetchingPromise;\r\n\t\t\t\t});\r\n\t\t\t\treturn promise;\t\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tlet promise = this._fetchingPromise = Base.prototype.fetch.apply(this, arguments);\r\n\t\t\treturn promise;\r\n\t\t}\r\n\t}\r\n});\r\n","import _ from 'underscore';\r\nimport { isKnownCtor, mergeOptions, getOption } from 'bbmn-utils';\r\n\r\nexport default Base => Base.extend({\r\n\r\n\tconstructor(opts){\r\n\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._initializeChildrenable(opts);\r\n\r\n\t},\r\n\r\n\t_initializeChildrenable(opts){\r\n\t\tmergeOptions.call(this, opts, ['parent', 'root']);\r\n\t\tif (this.parent == null && this.root == null) \r\n\t\t\tthis.root = this;\r\n\t},\r\n\r\n\t//call this method manualy for initialize children\r\n\tinitializeChildren(){\r\n\t\tif (this._childrenInitialized) return;\r\n\r\n\t\tlet children = getOption(this, 'children');\r\n\t\tthis._children = [];\r\n\t\t_(children).each(child => this._initializeChild(child));\r\n\r\n\t\tthis._childrenInitialized = true;\r\n\r\n\t},\r\n\r\n\t_initializeChild(arg){\r\n\t\tlet Child;\r\n\t\tlet options = {};\r\n\r\n\t\tif (isKnownCtor(arg))\r\n\t\t\tChild = arg;\r\n\t\telse if(_.isFunction(arg)){\r\n\t\t\t\r\n\t\t\tlet invoked = arg.call(this, this);\r\n\t\t\treturn this._initializeChild(invoked);\r\n\r\n\t\t} else if (_.isObject(arg)) {\r\n\t\t\tChild = arg.Child;\r\n\t\t\t_.extend(options, _.omit(arg, 'Child'));\r\n\t\t}\r\n\r\n\t\t\r\n\r\n\t\t_.extend(options, getOption(this, 'childOptions'), { parent: this });\r\n\t\toptions = this.buildChildOptions(options);\r\n\t\t\r\n\t\tlet child = this.buildChild(Child, options);\r\n\t\tthis._children.push(child);\r\n\r\n\t},\r\n\r\n\tbuildChildOptions(options){\r\n\t\treturn options;\r\n\t},\r\n\tbuildChild(Child, options){\r\n\t\t!Child && (Child = getOption(this, 'defaultChildClass') || this.prototype.constructor);\r\n\t\treturn new Child(options);\r\n\t},\r\n\t_getChildren(items, opts = {}){\r\n\t\tlet { exclude, filter, map } = opts;\r\n\r\n\t\tif(exclude != null && !_.isArray(exclude))\r\n\t\t\topts.exclude = [exclude];\r\n\r\n\t\tif(!_.isFunction(filter))\r\n\t\t\tdelete opts.filter;\r\n\r\n\t\tlet result = [];\r\n\t\t_(items).each((item, index) => {\r\n\r\n\t\t\tif(!this._childFilter(item, index, opts))\r\n\t\t\t\treturn;\r\n\r\n\t\t\tif(_.isFunction(map))\r\n\t\t\t\titem = map(item);\r\n\r\n\t\t\titem && result.push(item);\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\t_childFilter(item, index, opts = {}){\r\n\t\t\r\n\t\tif(opts.force) return item;\r\n\r\n\t\tlet { exclude, filter } = opts;\r\n\r\n\t\tif(_.isFunction(this.childFilter) && !this.childFilter(item, index, opts))\r\n\t\t\treturn;\r\n\r\n\t\tif(_.isArray(exclude) && exclude.indexOf(item) >= 0)\r\n\t\t\treturn;\r\n\r\n\t\tif(_.isFunction(filter) && !filter.call(this, item, index, opts))\r\n\t\t\treturn;\r\n\r\n\t\treturn item;\r\n\t},\r\n\tchildFilter: false,\r\n\tgetChildren(opts = {}){\r\n\t\tlet children = [].slice.call(this._children || []);\r\n\t\topts.reverse && children.length > 1 && children.reverse();\t\t\r\n\t\treturn this._getChildren(children, opts);\r\n\t},\r\n\tgetAllChildren(opts = {}){\r\n\r\n\t\tlet { includeSelf, map, reverse } = opts;\r\n\t\tlet options = _.omit(opts, 'includeSelf', 'map');\r\n\r\n\r\n\t\tlet children = this.getChildren(options);\r\n\t\tlet result = _(children).chain()\r\n\t\t\t.map(child => {\r\n\t\t\t\tlet children = child.getAllChildren(options);\r\n\t\t\t\treturn reverse ? [children, child] : [child, children];\r\n\t\t\t})\r\n\t\t\t.flatten()\r\n\t\t\t.value();\r\n\r\n\t\tif (includeSelf) {\r\n\t\t\tlet method = reverse ? 'push' : 'unshift';\r\n\t\t\tresult[method](this);\r\n\t\t}\r\n\t\t\r\n\t\tif (_.isFunction(map)) {\r\n\t\t\treturn _(result).chain().map(map).filter(f => !!f).value();\r\n\t\t} else {\t\t\t\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tgetParent(){\r\n\t\treturn this.parent;\r\n\t}\r\n\r\n\r\n\r\n}, { ChildrenableMixin: true });\r\n","import { betterResult, isCollection, isModel, isModelClass, isCollectionClass } from 'bbmn-utils';\r\nimport { Model, Collection } from 'bbmn-core';\r\nimport _ from 'underscore';\r\nexport default Base => Base.extend({\r\n\t\r\n\t// usage:\r\n\t// model.entity('users');\r\n\tentity(key){\r\n\t\treturn this._getNestedEntity(key);\r\n\t},\r\n\r\n\t// override this if you need to do something with just created entity\r\n\t// by default here is settled change handlers\r\n\tsetupNestedEntity(context){\r\n\t\tif (!context.entity) return;\r\n\t\tthis._setNestedEntityHandlers(context);\r\n\t\tthis._setNestedEntityParent(context.entity, context.parentKey);\r\n\t},\r\n\r\n\t_getNestedEntity(key){\r\n\t\t//get sure there is a nestedEntities store initialized;\r\n\t\tthis._initEntitiesStore();\r\n\t\t// compiling passed `nestedEntities` contexts, occurs only at first call\r\n\t\tthis._initOwnEntities();\r\n\t\t\r\n\t\tlet context = this._nestedEntities[key];\r\n\t\tif (!context) { return; }\r\n\t\tif (!context.entity && !context._compiled) {\r\n\t\t\tcontext.entity = this._buildNestedEntity(context);\r\n\t\t\tif (context.entity) {\r\n\t\t\t\tthis.setupNestedEntity(context);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn context.entity;\r\n\t},\r\n\t_buildNestedEntity(context){\r\n\t\tlet data = this.get(context.name);\r\n\t\tif (_.isFunction(context.build)) {\r\n\t\t\tcontext.entity = context.build.call(this, data, context, this);\r\n\t\t} else {\r\n\t\t\tlet args = context.args;\r\n\t\t\tif (!args) {\r\n\t\t\t\targs = [data];\r\n\t\t\t\tif(context.options) {\r\n\t\t\t\t\targs.push(context.options);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcontext.entity = new context.class(...args);\r\n\t\t}\r\n\t\tcontext._compiled;\r\n\t\treturn context.entity;\r\n\t},\r\n\t_initOwnEntities(){\r\n\t\tif (this._nestedEntitiesInitialized) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet compiled = betterResult(this, 'nestedEntities', { args: [ this ] });\r\n\t\tlet memo = this._nestedEntities;\r\n\t\t_.each(compiled, (context, key) => {\r\n\t\t\t// handle the case where its a runtime function or class definition\r\n\t\t\tcontext = betterResult({ context }, 'context', { args: [key] });\r\n\t\t\tif (isModelClass(context) || isCollectionClass(context) ) {\r\n\t\t\t\tcontext = {\r\n\t\t\t\t\tclass: context,\r\n\t\t\t\t};\r\n\t\t\t} \r\n\t\t\t// when its just a property name, trying to determine type of data and use default class\r\n\t\t\telse if (_.isString(context)) {\r\n\t\t\t\tcontext = {\r\n\t\t\t\t\tname: context\r\n\t\t\t\t};\r\n\t\t\t} else if (!_.isObject(context)) {\r\n\t\t\t\tcontext = {};\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tlet name = context.name || (_.isString(key) && key || undefined);\r\n\t\t\t\r\n\t\t\tif (!_.isString(name)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif(!context.name) {\r\n\t\t\t\tcontext.name = name;\r\n\t\t\t}\r\n\r\n\t\t\tif(!context.class) {\r\n\t\t\t\tlet data = this.get(context.name);\r\n\t\t\t\tif (_.isArray(data)) {\r\n\t\t\t\t\tcontext.class = this.NestedCollectionClass || Collection;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontext.class = this.NestedModelClass || Model;\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tmemo[name] = context;\r\n\r\n\t\t});\r\n\r\n\t\tthis._nestedEntitiesInitialized = true;\r\n\t},\r\n\t_initEntitiesStore(){\r\n\t\tif(!_.has(this, '_nestedEntities')){\r\n\t\t\tthis._nestedEntities = {};\r\n\t\t}\r\n\t},\t\r\n\t_setNestedEntityHandlers(context){\r\n\t\tlet { name, entity } = context;\r\n\t\tlet entityChangeEvents = 'change';\r\n\r\n\t\tif (isCollection(entity)) {\r\n\t\t\tentityChangeEvents += ' update reset';\r\n\t\t}\r\n\r\n\t\t// if entity get changed outside we should keep in sync this model property value\r\n\t\tif(!context.onEntityChange){\r\n\t\t\tcontext.onEntityChange = (instance, { changeInitiator } = {}) => {\r\n\t\t\t\tif (changeInitiator == this) return;\r\n\t\t\t\tchangeInitiator == null && (changeInitiator = entity);\r\n\t\t\t\tlet json = entity.toJSON();\r\n\t\t\t\tthis.set(name, json, { changeInitiator });\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.listenTo(entity, entityChangeEvents, context.onEntityChange);\r\n\r\n\t\t// if this model property get changed outside we should keep in sync our nested entity\r\n\t\tif(!context.onPropertyChange) {\r\n\t\t\tcontext.onPropertyChange = (instance, _newvalue, { changeInitiator }) => {\r\n\t\t\t\tif (changeInitiator == this) return;\r\n\t\t\t\tchangeInitiator == null && (changeInitiator = this);\r\n\t\t\t\tlet val = this.get(name) || {};\r\n\t\t\t\tif(isModel(entity)){\r\n\t\t\t\t\tlet unset = _.reduce(entity.attributes, (memo, _val, key) => {\r\n\t\t\t\t\t\tif(key in val) return memo;\r\n\t\t\t\t\t\tmemo[key] = undefined;\r\n\t\t\t\t\t\treturn memo;\r\n\t\t\t\t\t}, {});\r\n\t\t\t\t\tentity.set(_.extend({}, val, unset), { changeInitiator });\r\n\t\t\t\t\tentity.set(unset, { unset: true, silent: true });\r\n\t\t\t\t}\t\t\t\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.on('change:' + name, context.onPropertyChange);\r\n\t},\r\n\t_setNestedEntityParent(entity, parentKey){\r\n\t\tparentKey || (parentKey = 'parent');\r\n\t\tentity[parentKey] = this;\r\n\t},\r\n\t_unsetNestedEntityParent(entity, parentKey){\r\n\t\tparentKey || (parentKey = 'parent');\r\n\t\tdelete entity[parentKey];\r\n\t},\r\n\tdestroy(){\r\n\t\tthis.dispose({ destroying: true });\r\n\t\tlet destroy = Base.prototype.destroy;\r\n\t\treturn destroy && destroy.apply(this, arguments);\r\n\t},\r\n\tdispose(opts){\r\n\t\tthis._disposeEntities(opts);\r\n\t\tlet dispose = Base.prototype.dispose;\t\t\r\n\t\treturn dispose && dispose.apply(this, arguments);\r\n\t},\r\n\t_disposeEntities(opts){\r\n\t\t_.each(this._nestedEntities, context => this._disposeEntity(context, opts));\r\n\t\tdelete this._nestedEntities;\r\n\t},\r\n\t_disposeEntity({ entity, name, onEntityChange, onPropertyChange, parentKey } = {}, { destroying } = {}){\r\n\t\tthis.stopListening(entity, null, onEntityChange);\r\n\t\tthis.off('change:'+ name, onPropertyChange);\r\n\t\tthis._unsetNestedEntityParent(entity, parentKey);\r\n\t\tlet method = destroying ? 'destroy' : 'dispose';\r\n\t\tentity[method] && entity[method]();\r\n\t},\r\n});\r\n","import _ from 'underscore';\r\nimport { betterResult as result, getOption, mergeOptions } from 'bbmn-utils';\r\n\r\n// previous version, deprecated\r\nconst Mixin = Base => Base.extend({\r\n\r\n\t//property first approach\r\n\tgetProperty(key, opts){\r\n\t\t\r\n\t\tlet defaultGetArguments = result(this, '_getPropertyArguments', { args:[this], default:[this] });\r\n\t\tlet options = _.extend({\r\n\t\t\tdeep: Mixin.defaults.deep,\r\n\t\t\tforce: Mixin.defaults.force,\r\n\t\t\targs: defaultGetArguments\r\n\t\t}, opts, {\r\n\t\t\tcontext: this,\r\n\t\t});\r\n\t\tlet { deep } = options;\r\n\r\n\t\tlet value = result(this, key, options);\r\n\t\tif (value == null && deep !== false) {\r\n\t\t\tvalue = result(this.options, key, options);\r\n\t\t}\r\n\t\treturn value;\r\n\t},\r\n\r\n\t//options first approach\r\n\tgetOption(key, opts){\r\n\t\tlet defaultGetArguments = result(this, '_getOptionArguments', { args:[this], default:[this] });\r\n\t\tlet options = _.extend({\r\n\t\t\tdeep: Mixin.defaults.deep,\r\n\t\t\tforce: Mixin.defaults.force,\r\n\t\t\targs: defaultGetArguments\r\n\t\t}, opts);\r\n\r\n\t\treturn getOption(this, key, options);\r\n\t},\r\n\r\n\tmergeOptions(values = {}, keys = [], opts = {}){\r\n\t\t\r\n\t\tif(_.isString(keys))\r\n\t\t\tkeys = keys.split(/\\s*,\\s*/);\r\n\r\n\t\t_.each(keys, (key) => {\r\n\t\t\tconst option = result(values, key, _.extend({ force: false }, opts));\r\n\t\t\tif (option !== undefined) {\r\n\t\t\t\tthis[key] = option;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t}\r\n\r\n}, {\r\n\tGetOptionMixin:true\r\n});\r\n\r\nMixin.defaults = {\r\n\tdeep: true,\r\n\tforce: true\r\n};\r\n\r\n//export default Mixin;\r\n\r\nexport default Base => Base.extend({\r\n\tgetOption(){\r\n\t\treturn getOption(this, ...arguments);\r\n\t},\r\n\thasOption(key){\r\n\t\tlet opts = this.options || {};\r\n\t\treturn (opts[key] != null) || (this[key] != null);\r\n\t},\r\n\tmergeOptions\r\n});\r\n","import _ from 'underscore';\r\nimport { isModelClass, isCollectionClass, getByPath, betterResult } from 'bbmn-utils';\r\n\r\nfunction urlError() {\r\n\tthrow new Error('A \"url\" property or function must be specified');\r\n}\r\n\r\nfunction mixinError(){\r\n\tthrow new Error('This mixin can be applied only on Model or Collection');\r\n}\r\n\r\nfunction getUrlPattern(){\r\n\tlet path = betterResult(this, 'urlPattern', { args: [this], default:'' });\r\n\treturn path.replace(/\\{([^}]+)\\}/g, (match, group) => {\r\n\t\tlet value = getByPath(this, group);\r\n\t\treturn value;\r\n\t});\r\n}\r\n\r\nconst ModelMixin = Base => Base.extend({\r\n\tgetUrlPattern,\r\n\tgetBaseUrl(){\r\n\t\tlet base =\r\n        betterResult(this, 'urlRoot', { args:[this]}) ||\r\n\t\tbetterResult(this, 'url', { args:[this]}) ||\r\n\t\tthis.getUrlPattern();\r\n\t\treturn base;\r\n\t},\r\n\turl(){\r\n\t\tlet base = this.getBaseUrl();\r\n\t\tif (!base) {\r\n\t\t\turlError();\r\n\t\t}\r\n\t\tif (this.isNew()) return base;\r\n\t\tvar id = this.get(this.idAttribute);\r\n\t\treturn base.replace(/[^/]$/, '$&/') + encodeURIComponent(id);  \r\n\t}\r\n});\r\n\r\n\r\nconst CollectionMixin = Base => Base.extend({\r\n\turl(){\r\n\t\tif (this.urlPattern) {\t\t\t\r\n\t\t\treturn this.getUrlPattern();\r\n\t\t}\r\n\t},\r\n\tgetUrlPattern\r\n});\r\n\r\n\r\nexport default Base => {\r\n\r\n\tconst mixin = isModelClass(Base) ? ModelMixin(Base)\r\n\t\t: isCollectionClass(Base) ? CollectionMixin(Base)\r\n\t\t\t: mixinError();\r\n\r\n\treturn mixin;\r\n\t\r\n};\r\n","//import getOptionMixin from './get-option/index.js';\r\nimport improvedFetchMixin from './improved-fetch/index.js';\r\nimport childrenableMixin from './childrenable/index.js';\r\nimport nestedEntitiesMixin from './nested-entities';\r\nimport optionsMixin from './options';\r\nimport urlPatternMixin from './url-pattern';\r\nexport {\r\n\toptionsMixin, improvedFetchMixin, childrenableMixin, nestedEntitiesMixin, urlPatternMixin\r\n};\r\n","import _ from 'underscore';\r\nexport default function getNestedResult(value, context, schema) {\r\n\treturn value != null \r\n\t\t&& _.isFunction(schema.nested) \r\n\t\t&& schema.nested(value, context);\r\n}\r\n","import _ from 'underscore';\r\nexport default function getPropertySchema(model, key)\r\n{\r\n\tif (_.isFunction(model.getPropertySchema)) {\r\n\t\treturn model.getPropertySchema(key);\r\n\t} else {\r\n\t\treturn {};\r\n\t}\r\n}\r\n","import _ from 'underscore';\r\nexport default function getDisplayConfig(key, model, schema){\r\n\tif (key == null) return {};\r\n\treturn (_.isFunction(model.getPropertyDisplayConfig) && model.getPropertyDisplayConfig(key))\r\n\t\t|| (schema && schema.display) || {};\r\n}\r\n","import _ from 'underscore';\r\nimport { Model } from 'bbmn-core';\r\nimport { getByPath } from 'bbmn-utils';\r\n\r\nimport getNestedResult from './get-nested-result.js';\r\nimport getPropertySchema from './get-property-schema.js';\r\nimport getDisplayConfig from './get-display-config.js';\r\n\r\n\r\nexport default Base => {\r\n\tconst originalGet = Model.prototype.get;\r\n\tconst Mixed = Base.extend({\r\n\t\tgetByPath(key){\r\n\t\t\tif(key.indexOf('.') > -1)\r\n\t\t\t\treturn getByPath(this, key);\r\n\t\t\telse\r\n\t\t\t\treturn originalGet.call(this, key);\r\n\t\t},\r\n\t\tget(key, opts = {}){\r\n\t\t\tif(key == null || key == '') return;\t\r\n\t\t\t\r\n\t\t\tlet value = 'value' in opts \r\n\t\t\t\t? opts.value\r\n\t\t\t\t: this.getByPath.call(this, key);\r\n\r\n\t\t\tif (!_.size(opts)) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\r\n\t\t\tlet prop = getPropertySchema(this, key);\r\n\t\t\tlet result = opts.nested && getNestedResult(value, this, prop);\r\n\t\t\tif (result != null) {\r\n\t\t\t\treturn result;\r\n\t\t\t}\r\n\r\n\t\t\tif(_.isFunction(opts.transform) && !opts.raw) {\r\n\t\t\t\tvalue = opts.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif(_.isFunction(prop.transform) && !opts.raw){\r\n\t\t\t\tvalue = prop.transform.call(this, value, opts, this);\r\n\t\t\t}\r\n\r\n\t\t\tif(opts.display === true){\r\n\r\n\t\t\t\tlet display = getDisplayConfig(key, this, prop);\r\n\r\n\t\t\t\tif(opts.alternative){\r\n\t\t\t\t\tvalue = _.isFunction(display.alternative) && display.alternative.call(this, value, _.extend({},opts,prop), this);\r\n\t\t\t\t}\r\n\t\t\t\telse if(_.isFunction(display.transform)) {\r\n\t\t\t\t\tvalue = display.transform.call(this, value, opts, this);\r\n\t\t\t\t}\r\n\t\t\t\tif(display.ifEmpty && (value == null || value === ''))\r\n\t\t\t\t\treturn display.ifEmpty;\r\n\t\t\t}\r\n\r\n\t\t\treturn value;\r\n\t\t},\r\n\t\tdisplay(key, opts = {}){\r\n\t\t\t_.extend(opts, { display:true });\r\n\t\t\treturn this.get(key, opts);\r\n\t\t},\r\n\t\tpropertyName(key) {\r\n\t\t\tlet prop = getPropertySchema(this, key);\r\n\t\t\tlet display = getDisplayConfig(key, this, prop);\r\n\t\t\treturn display.label || key;\r\n\t\t}\r\n\t});\r\n\r\n\treturn Mixed;\r\n};\r\n","import _ from 'underscore';\r\nexport default Base => Base.extend({\r\n\tdefaultWait: false,\r\n\tsaveReturnPromise: false,\r\n\tpatchInsteadSave: false,\r\n\tsave(key, val, options){\r\n\t\tlet attrs;\r\n\t\tif (key == null || typeof key === 'object') {\r\n\t\t\tattrs = key;\r\n\t\t\toptions = val;\r\n\t\t} else {\r\n\t\t\t(attrs = {})[key] = val;\r\n\t\t}\r\n\t\toptions || (options = {});\r\n\t\tif(!_.has(options, 'wait')){\r\n\t\t\toptions.wait = this.defaultWait;\r\n\t\t}\r\n\t\tif(!_.has(options, 'patch')) {\r\n\t\t\toptions.patch = this.patchInsteadSave;\r\n\t\t}\r\n\t\tconst save = Base.prototype.save.call(this, attrs, options);\r\n\t\tif (!this.saveReturnPromise) {\r\n\t\t\treturn save;\r\n\t\t}\r\n\r\n\t\tif (save && _.isFunction(save.then)) {\r\n\t\t\treturn save;\r\n\t\t}\r\n\t\tif (!save) {\r\n\t\t\treturn Promise.reject(save);\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve(save);\r\n\t\t}\r\n\t}\r\n});\r\n","import { buildViewByKey } from 'bbmn-utils';\r\nexport default Base => Base.extend({\r\n\tbuildViewByKey(...args){\r\n\t\treturn buildViewByKey.call(this, ...args);\r\n\t},\r\n});\r\n","import { betterResult } from 'bbmn-utils';\r\nimport _ from 'underscore';\r\n\r\nconst defaultCssConfig = {\r\n\tbeforeRender: true,\r\n\tmodelChange: true,\r\n\trefresh: true,\r\n};\r\n\r\nexport default (Base) => Base.extend({\r\n\tconstructor(){\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis._setupCssClassModifiers();\t\t\r\n\t},\r\n\t_initCssClassModifiers(){\r\n\t\tif (this.hasOwnProperty('cssClassModifiers')) { return; }\r\n\t\tlet modifiers = [];\r\n\t\tlet optsModifiers = betterResult(this.options || {}, 'cssClassModifiers', { args:[this.model, this], default: [] });\r\n\t\tlet propsModifiers = betterResult(this, 'cssClassModifiers', { args:[this.model, this], default: [] });\r\n\t\tmodifiers.push(...optsModifiers);\r\n\t\tmodifiers.push(...propsModifiers);\r\n\t\tthis.cssClassModifiers = modifiers;\r\n\t},\r\n\taddCssClassModifier(...modifiers){\r\n\t\tthis._initCssClassModifiers();\r\n\t\tthis.cssClassModifiers.push(...modifiers);\r\n\t},\r\n\trefreshCssClass(){\r\n\t\tlet className = this._getCssClassString();\r\n\t\tif(className == ''){\r\n\t\t\tthis.$el.removeAttr('class');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.$el.attr({\r\n\t\t\t\tclass: className\r\n\t\t\t});\r\n\t\t}\r\n\t},\t\r\n\r\n\t_getCssClassModifiers(){\r\n\t\tthis._initCssClassModifiers();\r\n\t\tlet className = betterResult(this, 'className', { args:[this.model, this], default: [] });\r\n\t\tlet modifiers = this.cssClassModifiers.concat([className]);\r\n\t\treturn modifiers;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassModifiers(){\r\n\t\treturn this._getCssClassModifiers();\r\n\t},\r\n\t_getCssClassString()\r\n\t{\r\n\t\tlet modifiers = this.getCssClassModifiers();\r\n\t\t\r\n\t\tlet classes = _(modifiers).reduce((hash, modifier) => {\r\n\t\t\tif(modifier == null || modifier === '') { return hash; }\r\n\t\t\tlet cls;\r\n\t\t\tif (_.isString(modifier)) {\r\n\t\t\t\tcls = modifier;\r\n\t\t\t} else if (_.isFunction(modifier)) {\r\n\t\t\t\tlet builded = modifier.call(this, this.model, this);\r\n\t\t\t\tcls = _.isString(builded) && builded || undefined;\r\n\t\t\t}\r\n\t\t\tcls && (hash[cls] = true);\r\n\t\t\treturn hash;\r\n\t\t}, {});\r\n\r\n\t\treturn _.keys(classes).join(' ');\r\n\r\n\t},\r\n\r\n\t_setupCssClassModifiers(){\r\n\r\n\t\tif(this._cssClassModifiersInitialized) return;\r\n\r\n\t\tlet cfg = this.getCssClassConfig();\r\n\t\tif(!cfg) return;\r\n\r\n\t\tlet events = this.getCssClassEvents(cfg);\r\n\t\t_(events).each((eventName) => this.on(eventName, this.refreshCssClass));\r\n\r\n\t\tif (cfg.modelChange && this.model) {\r\n\t\t\tthis.listenTo(this.model, 'change', this.refreshCssClass);\r\n\t\t}\r\n\r\n\t\tthis._cssClassModifiersInitialized = true;\r\n\t},\r\n\t\r\n\t_getCssClassConfig(){\r\n\t\tlet cfg = _.extend({}, defaultCssConfig, this.getOption('cssClassConfig'));\r\n\t\tif(!cfg || _.size(cfg) == 0) return;\r\n\t\treturn cfg;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassConfig(){\r\n\t\treturn this._getCssClassConfig();\r\n\t},\r\n\r\n\t_getCssClassEvents(cfg){\r\n\t\tlet events = [].concat(cfg.events || []);\r\n\t\tif(cfg.refresh) events.push('refresh');\r\n\t\tif(cfg.beforeRender) events.push('before:render');\r\n\t\tevents = _(events).uniq();\r\n\t\treturn events;\r\n\t},\r\n\t//override this if you need other logic\r\n\tgetCssClassEvents(cfg){\r\n\t\treturn this._getCssClassEvents(cfg);\r\n\t}\r\n}, { CssClassModifiersMixin: true });\r\n","export default Base => Base.extend({\r\n\tdestroy(){\r\n\t\tif(this._isDestroyed || this._isDestroying) { return; }\r\n\t\tthis._isDestroying = true;\r\n\t\tBase.prototype.destroy.apply(this, arguments);\r\n\t\tdelete this._isDestroying;\r\n\t},\r\n\tisDestroyed(){\r\n\t\treturn this._isDestroyed || this._isDestroying;\r\n\t}\r\n}, { DestroyMixin: true });\r\n","import _ from 'underscore';\r\nimport $ from 'jquery';\r\n\r\nconst defaultSelector = (name, prefix = '') => prefix + 'region-' + name;\r\n\r\nfunction defaultUpdateDom(name, $el)\r\n{\r\n\tlet selector = defaultSelector(name);\r\n\tlet element = $('<div>').addClass(selector);\r\n\t$el.append(element);\r\n\r\n\treturn '.' + selector;\r\n}\r\n\r\nexport default function buildRegionFunc(view, hash, context){\r\n\r\n\tlet { $el } = view;\t\r\n\tlet { autoCreateRegion } = context;\r\n\tlet { updateDom, name, el } = hash;\r\n\tlet regionEl;\r\n\t\r\n\tlet region = view.getRegion(name);\r\n\r\n\r\n\tif (el == null && autoCreateRegion !== false) {\r\n\r\n\t\tlet testEl = region && region.getOption('el',{ deep:false});\r\n\r\n\t\tif (!region || !testEl || !$el.find(testEl).length) {\r\n\r\n\t\t\tregionEl = defaultUpdateDom(name, $el);\r\n\r\n\t\t} \r\n\r\n\t} else if(_.isFunction(updateDom)) {\r\n\t\tupdateDom.call(view, $el, view);\r\n\r\n\t} \r\n\t\r\n\t\r\n\tif (!region) {\r\n\t\tlet definition = _.pick(hash, 'replaceElement', 'regionClass');\r\n\t\tdefinition.el = hash.el || regionEl;\r\n\t\tregion = view.addRegion(name, definition);\r\n\t}\r\n\r\n\r\n\treturn region;\r\n}\r\n","import _ from 'underscore';\r\nimport buildRegion from './build-region.js';\r\n\r\nexport default function normalizeNestedViewContextRegion(context) {\r\n\r\n\tlet { region } = context;\r\n\tlet regionName = (_.isString(region) && region) || context.regionName || context.name;\r\n\r\n\tif (_.isString(region) || region == null) {\r\n\t\tregion = {};\r\n\t} else if (_.isFunction(region)) {\r\n\t\tregion = region.call(this, context, this);\r\n\t}\r\n\r\n\tif (_.isObject(region)) {\r\n\r\n\t\tif(!region.name)\r\n\t\t\tregion.name = regionName;\r\n\t\tlet replaceElement = this.getOption('replaceNestedElement');\r\n\t\tcontext.region = _.extend({ replaceElement }, region);\r\n\t\tcontext.show = _.partial(buildRegion, this, context.region, context);\r\n\t}\r\n\treturn context;\r\n}\r\n","import _ from 'underscore';\r\nimport { betterResult as result } from 'bbmn-utils';\r\nimport { isView, isViewClass } from 'bbmn-core';\r\nimport normalizeRegion from './normalize-region.js';\r\nexport default Base => Base.extend({\r\n\tconstructor(){\r\n\t\tthis._nestedViews = {};\r\n\t\tBase.apply(this, arguments);\r\n\t\tthis.initializeNestedViews();\r\n\t},\r\n\ttemplate: false,\r\n\r\n\tshowAllNestedViewsOnRender: false,\r\n\tshowNestedViewOnAdd: false,\r\n\treplaceNestedElement: true,\r\n\r\n\tinitializeNestedViews(){\r\n\t\tif (this._nestedViewsInitialized) return;\r\n\r\n\t\tif(this.getOption('showAllNestedViewsOnRender')) {\r\n\t\t\tthis.on('render', () => this.showAllNestedViews());\r\n\t\t}\r\n\r\n\t\tlet nesteds = this.getOption('nestedViews', { args:[this.model, this]});\r\n\t\t_(nesteds).each((context, index) => {\r\n\r\n\t\t\tlet name = _.isString(index) ? index : (context.name || _.uniqueId('nested'));\r\n\t\t\tthis.addNestedView(name, context);\r\n\r\n\t\t});\r\n\r\n\t\tthis._nestedViewsInitialized = true;\r\n\t},\r\n\t_normalizeNestedContext(name, context){\r\n\r\n\t\tif (isViewClass(context)) {\r\n\t\t\tlet View = context;\r\n\t\t\tcontext = {\r\n\t\t\t\tname, View\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t//unwrap to plain object\r\n\t\tif (_.isFunction(context)) {\r\n\t\t\tcontext = context.call(this, this.model, this);\r\n\t\t}\r\n\r\n\t\t//fix name if its not provided\r\n\t\tif (context.name == null) {\r\n\t\t\tcontext.name = name || _.uniqueId('nested');\r\n\t\t}\r\n\r\n\t\t//convert region to valid function\r\n\t\tcontext = normalizeRegion.call(this, context);\t\t\r\n\r\n\r\n\t\treturn context;\r\n\t},\r\n\t_createNestedContext(context){\r\n\t\tlet contexts = this.getNestedViewContext();\r\n\t\tcontexts[context.name] = context;\r\n\t},\r\n\r\n\taddNestedView(name, context){\r\n\r\n\t\tif (!_.isString(name) || name === '') {\r\n\t\t\tthrow new Error('addNestedView: first argument should be a string');\r\n\t\t}\r\n\r\n\t\tcontext = this._normalizeNestedContext(name, context);\r\n\t\tthis._createNestedContext(context);\r\n\t\tif(this.getOption('showNestedViewOnAdd') && this.isRendered()){\r\n\t\t\tthis.showNestedView(context);\r\n\t\t}\t\t\r\n\t},\r\n\r\n\tshowNestedView(name){\r\n\t\tlet region = this.getNestedViewRegion(name);\r\n\t\tlet view = region && this.buildNestedView(name);\r\n\t\tif (view) {\r\n\t\t\tregion.show(view);\r\n\t\t}\r\n\t},\r\n\tshowAllNestedViews(){\r\n\t\tlet contexts = this.getNestedViewContext();\r\n\t\t_(contexts).each(context => this.showNestedView(context));\r\n\t},\r\n\tgetNestedViewContext(name){\r\n\t\tlet contexts = this._nestedViews;\r\n\t\tif (arguments.length == 0)\r\n\t\t\treturn contexts;\r\n\t\telse\r\n\t\t\treturn contexts[name];\r\n\t},\r\n\r\n\r\n\tbuildNestedView(name){\r\n\r\n\t\tlet context = _.isObject(name) ? name\r\n\t\t\t: _.isString(name) ? this.getNestedViewContext(name)\r\n\t\t\t\t: null;\r\n\r\n\t\tif(!context) return;\r\n\t\tlet passedView = result(context, 'view', { context: this, args: [this, this.model] });\r\n\t\tif(_.isFunction(context.template))\r\n\t\t\treturn context.template;\r\n\t\telse if ( isView(passedView) ) {\r\n\t\t\treturn passedView;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet View = context.View;\r\n\t\t\tlet options = this.buildNestedViewOptions(result(context, 'options', { context: this, args: [this, this.model], default:{} }));\r\n\t\t\t\r\n\t\t\treturn new View(options);\r\n\t\t}\r\n\t},\r\n\tbuildNestedViewOptions(opts){\r\n\t\treturn opts;\r\n\t},\r\n\tgetNestedViewRegion(name){\r\n\t\tlet context = _.isObject(name) ? name\r\n\t\t\t: _.isString(name) ? this.getNestedViewContext(name)\r\n\t\t\t\t: null;\r\n\t\treturn context && _.result(context, 'show');\r\n\t}\r\n\t\r\n});\r\n","import _ from 'underscore';\r\nexport default Base => Base.extend({\r\n\tdefaultWait: false,\r\n\tcreateReturnPromise: false,\r\n\tcreate(model, options = {}){\r\n\t\tif(!_.has(options, 'wait')){\r\n\t\t\toptions.wait = this.defaultWait;\r\n\t\t}\r\n\t\tconst create = Base.prototype.create.call(this, model, options);\r\n\t\tif (!this.createReturnPromise) {\r\n\t\t\treturn create;\r\n\t\t}\r\n\r\n\t\tif (create && _.isFunction(create.then)) {\r\n\t\t\treturn create;\r\n\t\t}\r\n\t\tif (!create) {\r\n\t\t\treturn Promise.reject(create);\r\n\t\t} else {\r\n\t\t\treturn Promise.resolve(create);\r\n\t\t}\r\n\t}\r\n});\r\n"],"names":["CollectionView","extend","apply","arguments","getOption","emptyView","_handleEmptyFetch","collection","length","listenToOnce","_renderChildren","Base","_emptyViewSelector","isFetching","isFetched","_","isFunction","fetching","fetched","wait","nodata","rebuildIndexes","models","index","model","view","_children","findByModel","_index","on","bind","_isModelView","prototype","_addChild","v1","v2","res","_hasUnrenderedViews","_addedViews","views","children","_views","triggerMethod","_showEmptyView","els","_getBuffer","_attachChildren","options","_isDestroyed","isObject","_isRendered","preventRender","render","hasIndex","isAddedToEnd","sort","_destroyEmptyView","isEmpty","EmptyView","_getEmptyView","_getEmptyViewOptions","_emptyViewInstance","addChildView","_removeChildView","_removeChild","destroy","CollectionViewMixin_4x","_customs","_collection","_initializeCustoms","optionsCustoms","betterResult","args","context","instanceCustoms","shouldMergeCustoms","add","concat","push","_renderCustoms","each","_renderedCustoms","rawcustoms","getCustoms","customs","_prepareCustoms","addChildViews","renderCustoms","clone","reduce","array","item","_prepareCustom","buildCustom","arg","call","isArray","isViewClass","childOptions","isView","viewOptions","_setupCustom","setupCustom","noop","awaitingRender","rendered","pop","undefined","CustomsMixin","_isFetching","_isFetched","concurrent","concurrentFetch","_fetchingPromise","promise","fetch","then","opts","_initializeChildrenable","parent","root","_childrenInitialized","_initializeChild","child","Child","isKnownCtor","invoked","omit","buildChildOptions","buildChild","constructor","items","exclude","filter","map","result","_childFilter","force","childFilter","indexOf","slice","reverse","_getChildren","includeSelf","getChildren","chain","getAllChildren","flatten","value","method","f","ChildrenableMixin","key","_getNestedEntity","entity","_setNestedEntityHandlers","_setNestedEntityParent","parentKey","_initEntitiesStore","_initOwnEntities","_nestedEntities","_compiled","_buildNestedEntity","setupNestedEntity","data","get","name","build","class","_nestedEntitiesInitialized","compiled","memo","isModelClass","isCollectionClass","isString","NestedCollectionClass","Collection","NestedModelClass","Model","has","entityChangeEvents","isCollection","onEntityChange","instance","changeInitiator","json","toJSON","set","listenTo","onPropertyChange","_newvalue","val","isModel","unset","attributes","_val","silent","dispose","destroying","_disposeEntities","_disposeEntity","stopListening","off","_unsetNestedEntityParent","urlError","Error","mixinError","getUrlPattern","path","default","replace","match","group","getByPath","ModelMixin","base","getBaseUrl","isNew","id","idAttribute","encodeURIComponent","CollectionMixin","urlPattern","mixin","getNestedResult","schema","nested","getPropertySchema","getDisplayConfig","getPropertyDisplayConfig","display","originalGet","Mixed","size","prop","transform","raw","alternative","ifEmpty","label","attrs","defaultWait","patch","patchInsteadSave","save","saveReturnPromise","Promise","reject","resolve","buildViewByKey","defaultCssConfig","_setupCssClassModifiers","hasOwnProperty","modifiers","optsModifiers","propsModifiers","cssClassModifiers","_initCssClassModifiers","className","_getCssClassString","$el","removeAttr","attr","_getCssClassModifiers","getCssClassModifiers","classes","hash","modifier","cls","builded","keys","join","_cssClassModifiersInitialized","cfg","getCssClassConfig","events","getCssClassEvents","eventName","refreshCssClass","modelChange","_getCssClassConfig","refresh","beforeRender","uniq","_getCssClassEvents","CssClassModifiersMixin","_isDestroying","DestroyMixin","defaultSelector","prefix","defaultUpdateDom","selector","element","$","addClass","append","buildRegionFunc","autoCreateRegion","updateDom","el","regionEl","region","getRegion","testEl","deep","find","definition","pick","addRegion","normalizeNestedViewContextRegion","regionName","replaceElement","show","partial","buildRegion","_nestedViews","initializeNestedViews","_nestedViewsInitialized","showAllNestedViews","nesteds","uniqueId","addNestedView","View","normalizeRegion","contexts","getNestedViewContext","_normalizeNestedContext","_createNestedContext","isRendered","showNestedView","getNestedViewRegion","buildNestedView","passedView","template","buildNestedViewOptions","create","createReturnPromise"],"mappings":"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"}